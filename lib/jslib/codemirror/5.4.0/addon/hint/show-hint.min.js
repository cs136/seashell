(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(d){var g="CodeMirror-hint";var f="CodeMirror-hint-active";d.showHint=function(l,m,n){if(!m){return l.showHint(n)}if(n&&n.async){m.async=true}var o={hint:m};if(n){for(var p in n){o[p]=n[p]}}return l.showHint(o)};d.defineExtension("showHint",function(m){if(this.listSelections().length>1||this.somethingSelected()){return}if(this.state.completionActive){this.state.completionActive.close()}var l=this.state.completionActive=new a(this,m);if(!l.options.hint){return}d.signal(this,"startCompletion",this);l.update(true)});function a(l,n){this.cm=l;this.options=this.buildOptions(n);this.widget=null;this.debounce=0;this.tick=0;this.startPos=this.cm.getCursor();this.startLen=this.cm.getLine(this.startPos.line).length;var m=this;l.on("cursorActivity",this.activityFunc=function(){m.cursorActivity()})}var h=window.requestAnimationFrame||function(l){return setTimeout(l,1000/60)};var e=window.cancelAnimationFrame||clearTimeout;a.prototype={close:function(){if(!this.active()){return}this.cm.state.completionActive=null;this.tick=null;this.cm.off("cursorActivity",this.activityFunc);if(this.widget&&this.data){d.signal(this.data,"close")}if(this.widget){this.widget.close()}d.signal(this.cm,"endCompletion",this.cm)},active:function(){return this.cm.state.completionActive==this},pick:function(n,m){var l=n.list[m];if(l.hint){l.hint(this.cm,n,l)}else{this.cm.replaceRange(k(l),l.from||n.from,l.to||n.to,"complete")}d.signal(n,"pick",l);this.close()},cursorActivity:function(){if(this.debounce){e(this.debounce);this.debounce=0}var n=this.cm.getCursor(),l=this.cm.getLine(n.line);if(n.line!=this.startPos.line||l.length-n.ch!=this.startLen-this.startPos.ch||n.ch<this.startPos.ch||this.cm.somethingSelected()||(n.ch&&this.options.closeCharacters.test(l.charAt(n.ch-1)))){this.close()}else{var m=this;this.debounce=h(function(){m.update()});if(this.widget){this.widget.disable()}}},update:function(n){if(this.tick==null){return}if(this.data){d.signal(this.data,"update")}if(!this.options.hint.async){this.finishUpdate(this.options.hint(this.cm,this.options),n)}else{var m=++this.tick,l=this;this.options.hint(this.cm,function(o){if(l.tick==m){l.finishUpdate(o,n)}},this.options)}},finishUpdate:function(m,n){this.data=m;var l=(this.widget&&this.widget.picked)||(n&&this.options.completeSingle);if(this.widget){this.widget.close()}if(m&&m.list.length){if(l&&m.list.length==1){this.pick(m,0)}else{this.widget=new j(this,m);d.signal(m,"shown")}}},buildOptions:function(m){var n=this.cm.options.hintOptions;var l={};for(var o in b){l[o]=b[o]}if(n){for(var o in n){if(n[o]!==undefined){l[o]=n[o]}}}if(m){for(var o in m){if(m[o]!==undefined){l[o]=m[o]}}}return l}};function k(l){if(typeof l=="string"){return l}else{return l.text}}function c(p,s){var m={Up:function(){s.moveFocus(-1)},Down:function(){s.moveFocus(1)},PageUp:function(){s.moveFocus(-s.menuSize()+1,true)},PageDown:function(){s.moveFocus(s.menuSize()-1,true)},Home:function(){s.setFocus(0)},End:function(){s.setFocus(s.length-1)},Enter:s.pick,Tab:s.pick,Esc:s.close};var r=p.options.customKeys;var o=r?{}:m;function n(t,v){var u;if(typeof v!="string"){u=function(w){return v(w,s)}}else{if(m.hasOwnProperty(v)){u=m[v]}else{u=v}}o[t]=u}if(r){for(var q in r){if(r.hasOwnProperty(q)){n(q,r[q])}}}var l=p.options.extraKeys;if(l){for(var q in l){if(l.hasOwnProperty(q)){n(q,l[q])}}}return o}function i(m,l){while(l&&l!=m){if(l.nodeName.toUpperCase()==="LI"&&l.parentNode==m){return l}l=l.parentNode}}function j(y,I){this.completion=y;this.data=I;this.picked=false;var p=this,u=y.cm;var F=this.hints=document.createElement("ul");F.className="CodeMirror-hints";this.selectedHint=I.selectedHint||0;var t=I.list;for(var H=0;H<t.length;++H){var o=F.appendChild(document.createElement("li")),n=t[H];var m=g+(H!=this.selectedHint?"":" "+f);if(n.className!=null){m=n.className+" "+m}o.className=m;if(n.render){n.render(o,I,n)}else{o.appendChild(document.createTextNode(n.displayText||k(n)))}o.hintId=H}var s=u.cursorCoords(y.options.alignWithWord?I.from:null);var q=s.left,C=s.bottom,A=true;F.style.left=q+"px";F.style.top=C+"px";var v=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth);var G=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(y.options.container||document.body).appendChild(F);var w=F.getBoundingClientRect(),x=w.bottom-G;if(x>0){var D=w.bottom-w.top,l=s.top-(s.bottom-w.top);if(l-D>0){F.style.top=(C=s.top-D)+"px";A=false}else{if(D>G){F.style.height=(G-5)+"px";F.style.top=(C=s.bottom-w.top)+"px";var r=u.getCursor();if(I.from.ch!=r.ch){s=u.cursorCoords(r);F.style.left=(q=s.left)+"px";w=F.getBoundingClientRect()}}}}var z=w.right-v;if(z>0){if(w.right-w.left>v){F.style.width=(v-5)+"px";z-=(w.right-w.left)-v}F.style.left=(q=s.left-z)+"px"}u.addKeyMap(this.keyMap=c(y,{moveFocus:function(K,J){p.changeActive(p.selectedHint+K,J)},setFocus:function(J){p.changeActive(J)},menuSize:function(){return p.screenAmount()},length:t.length,close:function(){y.close()},pick:function(){p.pick()},data:I}));if(y.options.closeOnUnfocus){var E;u.on("blur",this.onBlur=function(){E=setTimeout(function(){y.close()},100)});u.on("focus",this.onFocus=function(){clearTimeout(E)})}var B=u.getScrollInfo();u.on("scroll",this.onScroll=function(){var M=u.getScrollInfo(),L=u.getWrapperElement().getBoundingClientRect();var K=C+B.top-M.top;var J=K-(window.pageYOffset||(document.documentElement||document.body).scrollTop);if(!A){J+=F.offsetHeight}if(J<=L.top||J>=L.bottom){return y.close()}F.style.top=K+"px";F.style.left=(q+B.left-M.left)+"px"});d.on(F,"dblclick",function(K){var J=i(F,K.target||K.srcElement);if(J&&J.hintId!=null){p.changeActive(J.hintId);p.pick()}});d.on(F,"click",function(K){var J=i(F,K.target||K.srcElement);if(J&&J.hintId!=null){p.changeActive(J.hintId);if(y.options.completeOnSingleClick){p.pick()}}});d.on(F,"mousedown",function(){setTimeout(function(){u.focus()},20)});d.signal(I,"select",t[0],F.firstChild);return true}j.prototype={close:function(){if(this.completion.widget!=this){return}this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var l=this.completion.cm;if(this.completion.options.closeOnUnfocus){l.off("blur",this.onBlur);l.off("focus",this.onFocus)}l.off("scroll",this.onScroll)},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var l=this;this.keyMap={Enter:function(){l.picked=true}};this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(l,n){if(l>=this.data.list.length){l=n?this.data.list.length-1:0}else{if(l<0){l=n?0:this.data.list.length-1}}if(this.selectedHint==l){return}var m=this.hints.childNodes[this.selectedHint];m.className=m.className.replace(" "+f,"");m=this.hints.childNodes[this.selectedHint=l];m.className+=" "+f;if(m.offsetTop<this.hints.scrollTop){this.hints.scrollTop=m.offsetTop-3}else{if(m.offsetTop+m.offsetHeight>this.hints.scrollTop+this.hints.clientHeight){this.hints.scrollTop=m.offsetTop+m.offsetHeight-this.hints.clientHeight+3}}d.signal(this.data,"select",this.data.list[this.selectedHint],m)},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}};d.registerHelper("hint","auto",function(l,m){var o=l.getHelpers(l.getCursor(),"hint"),q;if(o.length){for(var n=0;n<o.length;n++){var p=o[n](l,m);if(p&&p.list.length){return p}}}else{if(q=l.getHelper(l.getCursor(),"hintWords")){if(q){return d.hint.fromList(l,{words:q})}}else{if(d.hint.anyword){return d.hint.anyword(l,m)}}}});d.registerHelper("hint","fromList",function(l,m){var r=l.getCursor(),o=l.getTokenAt(r);var p=[];for(var n=0;n<m.words.length;n++){var q=m.words[n];if(q.slice(0,o.string.length)==o.string){p.push(q)}}if(p.length){return{list:p,from:d.Pos(r.line,o.start),to:d.Pos(r.line,o.end)}}});d.commands.autocomplete=d.showHint;var b={hint:d.hint.auto,completeSingle:true,alignWithWord:true,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:true,completeOnSingleClick:false,container:null,customKeys:null,extraKeys:null};d.defineOption("hintOptions",null)});