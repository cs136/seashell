(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../lib/codemirror"),require("../addon/search/searchcursor"),require("../addon/dialog/dialog"),require("../addon/edit/matchbrackets.js"))}else{if(typeof define=="function"&&define.amd){define(["../lib/codemirror","../addon/search/searchcursor","../addon/dialog/dialog","../addon/edit/matchbrackets"],a)}else{a(CodeMirror)}}})(function(b){var a=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"xi",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"dcc",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:false}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:true}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:true,linewise:true}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:false,linewise:true}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:true}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:false}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false,bigWord:true}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,inclusive:true}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,bigWord:true,inclusive:true}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false,bigWord:true}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,inclusive:true}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,bigWord:true,inclusive:true}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:false,toJumplist:true}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:true,toJumplist:true}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:true}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:false}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:true,explicitRepeat:true}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:false,explicitRepeat:true}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:true,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:false,toFirstChar:true}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:true}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:true,toJumplist:true}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:false}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:false}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:true}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:false}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true,linewise:true}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:true}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:false}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:true,linewise:true}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:false,linewise:true}},{keys:"]p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true,matchIndent:true}},{keys:"[p",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true,matchIndent:true}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:true,toJumplist:true}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:false,toJumplist:true}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:true},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:true}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:false}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:true},isEdit:true},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:false},isEdit:true},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:true}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:false,toJumplist:true}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:true},operatorMotionArgs:{visualLine:false}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:false},operatorMotionArgs:{visualLine:true}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:true},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:true},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:true},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:true},operatorArgs:{shouldMoveCursor:true},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false},context:"insert"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:true}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:false}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:true,linewise:true}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:false,linewise:true}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:true},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:false},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:true}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:true}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:true},{keys:"p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true}},{keys:"P",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true}},{keys:"r<character>",type:"action",action:"replace",isEdit:true},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{replace:true}},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:true},context:"visual",isEdit:true},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:false},context:"visual",isEdit:true},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:true,backtrack:false}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:false,backtrack:false}},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:true}},{keys:"/",type:"search",searchArgs:{forward:true,querySrc:"prompt",toJumplist:true}},{keys:"?",type:"search",searchArgs:{forward:false,querySrc:"prompt",toJumplist:true}},{keys:"*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"g*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",toJumplist:true}},{keys:"g#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",toJumplist:true}},{keys:":",type:"ex"}];var d=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:true},{name:"nohlsearch",shortName:"noh"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:true},{name:"global",shortName:"g"}];var c=b.Pos;var e=function(){function aY(bF){bF.setOption("disableInput",true);bF.setOption("showCursorWhenSelecting",false);b.signal(bF,"vim-mode-change",{mode:"normal"});bF.on("cursorActivity",ab);G(bF);b.on(bF.getInputField(),"paste",U(bF))}function aU(bF){bF.setOption("disableInput",false);bF.off("cursorActivity",ab);b.off(bF.getInputField(),"paste",U(bF));bF.state.vim=null}function i(bF,bG){if(this==b.keyMap.vim){b.rmClass(bF.getWrapperElement(),"cm-fat-cursor")}if(!bG||bG.attach!=t){aU(bF,false)}}function t(bF,bG){if(this==b.keyMap.vim){b.addClass(bF.getWrapperElement(),"cm-fat-cursor")}if(!bG||bG.attach!=t){aY(bF)}}b.defineOption("vimMode",false,function(bF,bH,bG){if(bH&&bF.getOption("keyMap")!="vim"){bF.setOption("keyMap","vim")}else{if(!bH&&bG!=b.Init&&/^vim/.test(bF.getOption("keyMap"))){bF.setOption("keyMap","default")}}});function a6(bH,bG){if(!bG){return undefined}var bF=L(bH);if(!bF){return false}var bI=b.Vim.findKey(bG,bF);if(typeof bI=="function"){b.signal(bG,"vim-keypress",bF)}return bI}var aD={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A"};var aX={Enter:"CR",Backspace:"BS",Delete:"Del"};function L(bH){if(bH.charAt(0)=="'"){return bH.charAt(1)}var bK=bH.split("-");if(/-$/.test(bH)){bK.splice(-2,2,"-")}var bF=bK[bK.length-1];if(bK.length==1&&bK[0].length==1){return false}else{if(bK.length==2&&bK[0]=="Shift"&&bF.length==1){return false}}var bJ=false;for(var bG=0;bG<bK.length;bG++){var bI=bK[bG];if(bI in aD){bK[bG]=aD[bI]}else{bJ=true}if(bI in aX){bK[bG]=aX[bI]}}if(!bJ){return false}if(B(bF)){bK[bK.length-1]=bF.toLowerCase()}return"<"+bK.join("-")+">"}function U(bF){var bG=bF.state.vim;if(!bG.onPasteFn){bG.onPasteFn=function(){if(!bG.insertMode){bF.setCursor(D(bF.getCursor(),0,1));q.enterInsertMode(bF,{},bG)}}}return bG.onPasteFn}var a2=/[\d]/;var aq=[b.isWordChar,function(bF){return bF&&!b.isWordChar(bF)&&!/\s/.test(bF)}],bz=[function(bF){return/\S/.test(bF)}];function au(bI,bG){var bH=[];for(var bF=bI;bF<bI+bG;bF++){bH.push(String.fromCharCode(bF))}return bH}var aj=au(65,26);var ao=au(97,26);var V=au(48,10);var aI=[].concat(aj,ao,V,["<",">"]);var l=[].concat(aj,ao,V,["-",'"',".",":","/"]);function g(bF,bG){return bG>=bF.firstLine()&&bG<=bF.lastLine()}function E(bF){return(/^[a-z]$/).test(bF)}function N(bF){return"()[]{}".indexOf(bF)!=-1}function ai(bF){return a2.test(bF)}function B(bF){return(/^[A-Z]$/).test(bF)}function T(bF){return(/^\s*$/).test(bF)}function J(bH,bF){for(var bG=0;bG<bF.length;bG++){if(bF[bG]==bH){return true}}return false}var aw={};function aN(bH,bG,bJ,bF,bK){if(bG===undefined&&!bK){throw Error("defaultValue is required unless callback is provided")}if(!bJ){bJ="string"}aw[bH]={type:bJ,defaultValue:bG,callback:bK};if(bF){for(var bI=0;bI<bF.length;bI++){aw[bF[bI]]=aw[bH]}}if(bG){aL(bH,bG)}}function aL(bH,bK,bF,bG){var bJ=aw[bH];bG=bG||{};var bI=bG.scope;if(!bJ){throw Error("Unknown option: "+bH)}if(bJ.type=="boolean"){if(bK&&bK!==true){throw Error("Invalid argument: "+bH+"="+bK)}else{if(bK!==false){bK=true}}}if(bJ.callback){if(bI!=="local"){bJ.callback(bK,undefined)}if(bI!=="global"&&bF){bJ.callback(bK,bF)}}else{if(bI!=="local"){bJ.value=bJ.type=="boolean"?!!bK:bK}if(bI!=="global"&&bF){bF.state.vim.options[bH]={value:bK}}}}function o(bH,bF,bG){var bK=aw[bH];bG=bG||{};var bJ=bG.scope;if(!bK){throw Error("Unknown option: "+bH)}if(bK.callback){var bI=bF&&bK.callback(undefined,bF);if(bJ!=="global"&&bI!==undefined){return bI}if(bJ!=="local"){return bK.callback()}return}else{var bI=(bJ!=="global")&&(bF&&bF.state.vim.options[bH]);return(bI||(bJ!=="local")&&bK||{}).value}}aN("filetype",undefined,"string",["ft"],function(bG,bF){if(bF===undefined){return}if(bG===undefined){var bH=bF.getOption("mode");return bH=="null"?"":bH}else{var bH=bG==""?"null":bG;bF.setOption("mode",bH)}});var ar=function(){var bJ=100;var bL=-1;var bI=0;var bH=0;var bG=new Array(bJ);function bK(bM,bO,bP){var bQ=bL%bJ;var bR=bG[bQ];function bN(bU){var bT=++bL%bJ;var bV=bG[bT];if(bV){bV.clear()}bG[bT]=bM.setBookmark(bU)}if(bR){var bS=bR.find();if(bS&&!bC(bS,bO)){bN(bO)}}else{bN(bO)}bN(bP);bI=bL;bH=bL-bJ+1;if(bH<0){bH=0}}function bF(bM,bQ){bL+=bQ;if(bL>bI){bL=bI}else{if(bL<bH){bL=bH}}var bR=bG[(bJ+bL)%bJ];if(bR&&!bR.find()){var bP=bQ>0?1:-1;var bO;var bN=bM.getCursor();do{bL+=bP;bR=bG[(bJ+bL)%bJ];if(bR&&(bO=bR.find())&&!bC(bN,bO)){break}}while(bL<bI&&bL>bH)}return bR}return{cachedCursor:undefined,add:bK,move:bF}};var j=function(bF){if(bF){return{changes:bF.changes,expectCursorActivityForChange:bF.expectCursorActivityForChange}}return{changes:[],expectCursorActivityForChange:false}};function aA(){this.latestRegister=undefined;this.isPlaying=false;this.isRecording=false;this.replaySearchQueries=[];this.onRecordingDone=undefined;this.lastInsertModeChanges=j()}aA.prototype={exitMacroRecordMode:function(){var bF=r.macroModeState;if(bF.onRecordingDone){bF.onRecordingDone()}bF.onRecordingDone=undefined;bF.isRecording=false},enterMacroRecordMode:function(bF,bH){var bG=r.registerController.getRegister(bH);if(bG){bG.clear();this.latestRegister=bH;if(bF.openDialog){this.onRecordingDone=bF.openDialog("(recording)["+bH+"]",null,{bottom:true})}this.isRecording=true}}};function G(bF){if(!bF.state.vim){bF.state.vim={inputState:new aE(),lastEditInputState:undefined,lastEditActionCommand:undefined,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},fakeCursor:null,insertMode:false,insertModeRepeat:undefined,visualMode:false,visualLine:false,visualBlock:false,lastSelection:null,lastPastedText:null,sel:{},options:{}}}return bF.state.vim}var r;function A(){r={searchQuery:null,searchIsReversed:false,lastSubstituteReplacePart:undefined,jumpList:ar(),macroModeState:new aA,lastChararacterSearch:{increment:0,forward:true,selectedCharacter:""},registerController:new ak({}),searchHistoryController:new a7({}),exCommandHistoryController:new a7({})};for(var bF in aw){var bG=aw[bF];bG.value=bG.defaultValue}}var bA;var aR={buildKeyMap:function(){},getRegisterController:function(){return r.registerController},resetVimGlobalState_:A,getVimGlobalState_:function(){return r},maybeInitVimState_:G,suppressErrorLogging:false,InsertModeKey:bo,map:function(bG,bH,bF){m.map(bG,bH,bF)},setOption:aL,getOption:o,defineOption:aN,defineEx:function(bF,bH,bG){if(!bH){bH=bF}else{if(bF.indexOf(bH)!==0){throw new Error('(Vim.defineEx) "'+bH+'" is not a prefix of "'+bF+'", command not registered')}}a8[bF]=bG;m.commandMap_[bH]={name:bF,shortName:bH,type:"api"}},handleKey:function(bF,bH,bG){var bI=this.findKey(bF,bH,bG);if(typeof bI==="function"){return bI()}},findKey:function(bL,bM,bK){var bI=G(bL);function bN(){var bP=r.macroModeState;if(bP.isRecording){if(bM=="q"){bP.exitMacroRecordMode();k(bL);return true}if(bK!="mapping"){I(bP,bM)}}}function bO(){if(bM=="<Esc>"){k(bL);if(bI.visualMode){aV(bL)}else{if(bI.insertMode){w(bL)}}return true}}function bF(bQ){var bP;while(bQ){bP=(/<\w+-.+?>|<\w+>|./).exec(bQ);bM=bP[0];bQ=bQ.substring(bP.index+bM.length);b.Vim.handleKey(bL,bM,"mapping")}}function bJ(){if(bO()){return true}var bR=bI.inputState.keyBuffer=bI.inputState.keyBuffer+bM;var bS=bM.length==1;var bP=bf.matchCommand(bR,a,bI.inputState,"insert");while(bR.length>1&&bP.type!="full"){var bR=bI.inputState.keyBuffer=bR.slice(1);var bT=bf.matchCommand(bR,a,bI.inputState,"insert");if(bT.type!="none"){bP=bT}}if(bP.type=="none"){k(bL);return false}else{if(bP.type=="partial"){if(bA){window.clearTimeout(bA)}bA=window.setTimeout(function(){if(bI.insertMode&&bI.inputState.keyBuffer){k(bL)}},o("insertModeEscKeysTimeout"));return !bS}}if(bA){window.clearTimeout(bA)}if(bS){var bQ=bL.getCursor();bL.replaceRange("",D(bQ,0,-(bR.length-1)),bQ,"+input")}k(bL);return bP.command}function bH(){if(bN()||bO()){return true}var bR=bI.inputState.keyBuffer=bI.inputState.keyBuffer+bM;if(/^[1-9]\d*$/.test(bR)){return true}var bS=/^(\d*)(.*)$/.exec(bR);if(!bS){k(bL);return false}var bQ=bI.visualMode?"visual":"normal";var bP=bf.matchCommand(bS[2]||bS[1],a,bI.inputState,bQ);if(bP.type=="none"){k(bL);return false}else{if(bP.type=="partial"){return true}}bI.inputState.keyBuffer="";var bS=/^(\d*)(.*)$/.exec(bR);if(bS[1]&&bS[1]!="0"){bI.inputState.pushRepeatDigit(bS[1])}return bP.command}var bG;if(bI.insertMode){bG=bJ()}else{bG=bH()}if(bG===false){return undefined}else{if(bG===true){return function(){}}else{return function(){return bL.operation(function(){bL.curOp.isVimOp=true;try{if(bG.type=="keyToKey"){bF(bG.toKeys)}else{bf.processCommand(bL,bI,bG)}}catch(bP){bL.state.vim=undefined;G(bL);if(!b.Vim.suppressErrorLogging){console.log(bP)}throw bP}return true})}}}},handleEx:function(bF,bG){m.processCommand(bF,bG)},defineMotion:at,defineAction:bt,defineOperator:bm,mapCommand:aB,_mapCommand:p,defineRegister:X,exitVisualMode:aV,exitInsertMode:w};function aE(){this.prefixRepeat=[];this.motionRepeat=[];this.operator=null;this.operatorArgs=null;this.motion=null;this.motionArgs=null;this.keyBuffer=[];this.registerName=null}aE.prototype.pushRepeatDigit=function(bF){if(!this.operator){this.prefixRepeat=this.prefixRepeat.concat(bF)}else{this.motionRepeat=this.motionRepeat.concat(bF)}};aE.prototype.getRepeat=function(){var bF=0;if(this.prefixRepeat.length>0||this.motionRepeat.length>0){bF=1;if(this.prefixRepeat.length>0){bF*=parseInt(this.prefixRepeat.join(""),10)}if(this.motionRepeat.length>0){bF*=parseInt(this.motionRepeat.join(""),10)}}return bF};function k(bF,bG){bF.state.vim.inputState=new aE();b.signal(bF,"vim-command-done",bG)}function bs(bH,bG,bF){this.clear();this.keyBuffer=[bH||""];this.insertModeChanges=[];this.searchQueries=[];this.linewise=!!bG;this.blockwise=!!bF}bs.prototype={setText:function(bH,bG,bF){this.keyBuffer=[bH||""];this.linewise=!!bG;this.blockwise=!!bF},pushText:function(bG,bF){if(bF){if(!this.linewise){this.keyBuffer.push("\n")}this.linewise=true}this.keyBuffer.push(bG)},pushInsertModeChanges:function(bF){this.insertModeChanges.push(j(bF))},pushSearchQuery:function(bF){this.searchQueries.push(bF)},clear:function(){this.keyBuffer=[];this.insertModeChanges=[];this.searchQueries=[];this.linewise=false},toString:function(){return this.keyBuffer.join("")}};function X(bG,bH){var bF=r.registerController.registers[bG];if(!bG||bG.length!=1){throw Error("Register name must be 1 character")}if(bF[bG]){throw Error("Register already defined "+bG)}bF[bG]=bH;l.push(bG)}function ak(bF){this.registers=bF;this.unnamedRegister=bF['"']=new bs();bF["."]=new bs();bF[":"]=new bs();bF["/"]=new bs()}ak.prototype={pushText:function(bJ,bG,bL,bK,bH){if(bK&&bL.charAt(0)=="\n"){bL=bL.slice(1)+"\n"}if(bK&&bL.charAt(bL.length-1)!=="\n"){bL+="\n"}var bI=this.isValidRegister(bJ)?this.getRegister(bJ):null;if(!bI){switch(bG){case"yank":this.registers["0"]=new bs(bL,bK,bH);break;case"delete":case"change":if(bL.indexOf("\n")==-1){this.registers["-"]=new bs(bL,bK)}else{this.shiftNumericRegisters_();this.registers["1"]=new bs(bL,bK)}break}this.unnamedRegister.setText(bL,bK,bH);return}var bF=B(bJ);if(bF){bI.pushText(bL,bK)}else{bI.setText(bL,bK,bH)}this.unnamedRegister.setText(bI.toString(),bK)},getRegister:function(bF){if(!this.isValidRegister(bF)){return this.unnamedRegister}bF=bF.toLowerCase();if(!this.registers[bF]){this.registers[bF]=new bs()}return this.registers[bF]},isValidRegister:function(bF){return bF&&J(bF,l)},shiftNumericRegisters_:function(){for(var bF=9;bF>=2;bF--){this.registers[bF]=this.getRegister(""+(bF-1))}}};function a7(){this.historyBuffer=[];this.iterator;this.initialPrefix=null}a7.prototype={nextMatch:function(bG,bF){var bL=this.historyBuffer;var bI=bF?-1:1;if(this.initialPrefix===null){this.initialPrefix=bG}for(var bK=this.iterator+bI;bF?bK>=0:bK<bL.length;bK+=bI){var bJ=bL[bK];for(var bH=0;bH<=bJ.length;bH++){if(this.initialPrefix==bJ.substring(0,bH)){this.iterator=bK;return bJ}}}if(bK>=bL.length){this.iterator=bL.length;return this.initialPrefix}if(bK<0){return bG}},pushInput:function(bF){var bG=this.historyBuffer.indexOf(bF);if(bG>-1){this.historyBuffer.splice(bG,1)}if(bF.length){this.historyBuffer.push(bF)}},reset:function(){this.initialPrefix=null;this.iterator=this.historyBuffer.length}};var bf={matchCommand:function(bK,bM,bF,bI){var bL=bp(bK,bM,bI,bF);if(!bL.full&&!bL.partial){return{type:"none"}}else{if(!bL.full&&bL.partial){return{type:"partial"}}}var bJ;for(var bH=0;bH<bL.full.length;bH++){var bG=bL.full[bH];if(!bJ){bJ=bG}}if(bJ.keys.slice(-11)=="<character>"){bF.selectedCharacter=Q(bK)}return{type:"full",command:bJ}},processCommand:function(bF,bG,bH){bG.inputState.repeatOverride=bH.repeatOverride;switch(bH.type){case"motion":this.processMotion(bF,bG,bH);break;case"operator":this.processOperator(bF,bG,bH);break;case"operatorMotion":this.processOperatorMotion(bF,bG,bH);break;case"action":this.processAction(bF,bG,bH);break;case"search":this.processSearch(bF,bG,bH);break;case"ex":case"keyToEx":this.processEx(bF,bG,bH);break;default:break}},processMotion:function(bF,bG,bH){bG.inputState.motion=bH.motion;bG.inputState.motionArgs=bn(bH.motionArgs);this.evalInput(bF,bG)},processOperator:function(bG,bH,bI){var bF=bH.inputState;if(bF.operator){if(bF.operator==bI.operator){bF.motion="expandToLine";bF.motionArgs={linewise:true};this.evalInput(bG,bH);return}else{k(bG)}}bF.operator=bI.operator;bF.operatorArgs=bn(bI.operatorArgs);if(bH.visualMode){this.evalInput(bG,bH)}},processOperatorMotion:function(bF,bI,bJ){var bH=bI.visualMode;var bG=bn(bJ.operatorMotionArgs);if(bG){if(bH&&bG.visualLine){bI.visualLine=true}}this.processOperator(bF,bI,bJ);if(!bH){this.processMotion(bF,bI,bJ)}},processAction:function(bG,bI,bL){var bF=bI.inputState;var bK=bF.getRepeat();var bJ=!!bK;var bH=bn(bL.actionArgs)||{};if(bF.selectedCharacter){bH.selectedCharacter=bF.selectedCharacter}if(bL.operator){this.processOperator(bG,bI,bL)}if(bL.motion){this.processMotion(bG,bI,bL)}if(bL.motion||bL.operator){this.evalInput(bG,bI)}bH.repeat=bK||1;bH.repeatIsExplicit=bJ;bH.registerName=bF.registerName;k(bG);bI.lastMotion=null;if(bL.isEdit){this.recordLastEdit(bI,bF,bL)}q[bL.action](bG,bH,bI)},processSearch:function(bU,bN,bM){if(!bU.getSearchCursor){return}var bP=bM.searchArgs.forward;var bK=bM.searchArgs.wholeWordOnly;aK(bU).setReversed(!bP);var bQ=(bP)?"/":"?";var bS=aK(bU).getQuery();var bH=bU.getScrollInfo();function bL(bX,bV,bW){r.searchHistoryController.pushInput(bX);r.searchHistoryController.reset();try{bB(bU,bX,bV,bW)}catch(bY){bq(bU,"Invalid regex: "+bX);k(bU);return}bf.processMotion(bU,bN,{type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:bM.searchArgs.toJumplist}})}function bT(bV){bU.scrollTo(bH.left,bH.top);bL(bV,true,true);var bW=r.macroModeState;if(bW.isRecording){O(bW,bV)}}function bJ(bZ,bY,b0){var bX=b.keyName(bZ),bV;if(bX=="Up"||bX=="Down"){bV=bX=="Up"?true:false;bY=r.searchHistoryController.nextMatch(bY,bV)||"";b0(bY)}else{if(bX!="Left"&&bX!="Right"&&bX!="Ctrl"&&bX!="Alt"&&bX!="Shift"){r.searchHistoryController.reset()}}var bW;try{bW=bB(bU,bY,true,true)}catch(bZ){}if(bW){bU.scrollIntoView(bD(bU,!bP,bW),30)}else{aO(bU);bU.scrollTo(bH.left,bH.top)}}function bG(bX,bW,bY){var bV=b.keyName(bX);if(bV=="Esc"||bV=="Ctrl-C"||bV=="Ctrl-["||(bV=="Backspace"&&bW=="")){r.searchHistoryController.pushInput(bW);r.searchHistoryController.reset();bB(bU,bS);aO(bU);bU.scrollTo(bH.left,bH.top);b.e_stop(bX);k(bU);bY();bU.focus()}else{if(bV=="Ctrl-U"){b.e_stop(bX);bY("")}}}switch(bM.searchArgs.querySrc){case"prompt":var bO=r.macroModeState;if(bO.isPlaying){var bR=bO.replaySearchQueries.shift();bL(bR,true,false)}else{a4(bU,{onClose:bT,prefix:bQ,desc:P,onKeyUp:bJ,onKeyDown:bG})}break;case"wordUnderCursor":var bI=aH(bU,false,true,false,true);var bF=true;if(!bI){bI=aH(bU,false,true,false,false);bF=false}if(!bI){return}var bR=bU.getLine(bI.start.line).substring(bI.start.ch,bI.end.ch);if(bF&&bK){bR="\\b"+bR+"\\b"}else{bR=h(bR)}r.jumpList.cachedCursor=bU.getCursor();bU.setCursor(bI.start);bL(bR,true,false);break}},processEx:function(bF,bG,bJ){function bI(bK){r.exCommandHistoryController.pushInput(bK);r.exCommandHistoryController.reset();m.processCommand(bF,bK)}function bH(bN,bL,bO){var bM=b.keyName(bN),bK;if(bM=="Esc"||bM=="Ctrl-C"||bM=="Ctrl-["||(bM=="Backspace"&&bL=="")){r.exCommandHistoryController.pushInput(bL);r.exCommandHistoryController.reset();b.e_stop(bN);k(bF);bO();bF.focus()}if(bM=="Up"||bM=="Down"){bK=bM=="Up"?true:false;bL=r.exCommandHistoryController.nextMatch(bL,bK)||"";bO(bL)}else{if(bM=="Ctrl-U"){b.e_stop(bN);bO("")}else{if(bM!="Left"&&bM!="Right"&&bM!="Ctrl"&&bM!="Alt"&&bM!="Shift"){r.exCommandHistoryController.reset()}}}}if(bJ.type=="keyToEx"){m.processCommand(bF,bJ.exArgs.input)}else{if(bG.visualMode){a4(bF,{onClose:bI,prefix:":",value:"'<,'>",onKeyDown:bH})}else{a4(bF,{onClose:bI,prefix:":",onKeyDown:bH})}}},evalInput:function(bN,bZ){var bS=bZ.inputState;var bW=bS.motion;var bT=bS.motionArgs||{};var bO=bS.operator;var b9=bS.operatorArgs||{};var bU=bS.registerName;var b0=bZ.sel;var ca=C(bZ.visualMode?aa(bN,b0.head):bN.getCursor("head"));var bL=C(bZ.visualMode?aa(bN,b0.anchor):bN.getCursor("anchor"));var bI=C(ca);var bH=C(bL);var bY,bR;var bP;if(bO){this.recordLastEdit(bZ,bS)}if(bS.repeatOverride!==undefined){bP=bS.repeatOverride}else{bP=bS.getRepeat()}if(bP>0&&bT.explicitRepeat){bT.repeatIsExplicit=true}else{if(bT.noRepeat||(!bT.explicitRepeat&&bP===0)){bP=1;bT.repeatIsExplicit=false}}if(bS.selectedCharacter){bT.selectedCharacter=b9.selectedCharacter=bS.selectedCharacter}bT.repeat=bP;k(bN);if(bW){var bX=a5[bW](bN,ca,bT,bZ);bZ.lastMotion=a5[bW];if(!bX){return}if(bT.toJumplist){var b8=r.jumpList;var bQ=b8.cachedCursor;if(bQ){bj(bN,bQ,bX);delete b8.cachedCursor}else{bj(bN,ca,bX)}}if(bX instanceof Array){bR=bX[0];bY=bX[1]}else{bY=bX}if(!bY){bY=C(ca)}if(bZ.visualMode){if(!(bZ.visualBlock&&bY.ch===Infinity)){bY=aa(bN,bY,bZ.visualBlock)}if(bR){bR=aa(bN,bR,true)}bR=bR||bH;b0.anchor=bR;b0.head=bY;M(bN);aT(bN,bZ,"<",aQ(bR,bY)?bR:bY);aT(bN,bZ,">",aQ(bR,bY)?bY:bR)}else{if(!bO){bY=aa(bN,bY);bN.setCursor(bY.line,bY.ch)}}}if(bO){if(b9.lastSel){bR=bH;var bF=b9.lastSel;var b5=Math.abs(bF.head.line-bF.anchor.line);var b7=Math.abs(bF.head.ch-bF.anchor.ch);if(bF.visualLine){bY=c(bH.line+b5,bH.ch)}else{if(bF.visualBlock){bY=c(bH.line+b5,bH.ch+b7)}else{if(bF.head.line==bF.anchor.line){bY=c(bH.line,bH.ch+b7)}else{bY=c(bH.line+b5,bH.ch)}}}bZ.visualMode=true;bZ.visualLine=bF.visualLine;bZ.visualBlock=bF.visualBlock;b0=bZ.sel={anchor:bR,head:bY};M(bN)}else{if(bZ.visualMode){b9.lastSel={anchor:C(b0.anchor),head:C(b0.head),visualBlock:bZ.visualBlock,visualLine:bZ.visualLine}}}var bM,b1,bJ,bV;var bK;if(bZ.visualMode){bM=ay(b0.head,b0.anchor);b1=bd(b0.head,b0.anchor);bJ=bZ.visualLine||b9.linewise;bV=bZ.visualBlock?"block":bJ?"line":"char";bK=bE(bN,{anchor:bM,head:b1},bV);if(bJ){var bG=bK.ranges;if(bV=="block"){for(var b2=0;b2<bG.length;b2++){bG[b2].head.ch=aZ(bN,bG[b2].head.line)}}else{if(bV=="line"){bG[0].head=c(bG[0].head.line+1,0)}}}}else{bM=C(bR||bH);b1=C(bY||bI);if(aQ(b1,bM)){var b6=bM;bM=b1;b1=b6}bJ=bT.linewise||b9.linewise;if(bJ){bh(bN,bM,b1)}else{if(bT.forward){an(bN,bM,b1)}}bV="char";var b4=!bT.inclusive||bJ;bK=bE(bN,{anchor:bM,head:b1},bV,b4)}bN.setSelections(bK.ranges,bK.primary);bZ.lastMotion=null;b9.repeat=bP;b9.registerName=bU;b9.linewise=bJ;var b3=K[bO](bN,b9,bK.ranges,bH,bY);if(bZ.visualMode){aV(bN,b3!=null)}if(b3){bN.setCursor(b3)}}},recordLastEdit:function(bG,bF,bH){var bI=r.macroModeState;if(bI.isPlaying){return}bG.lastEditInputState=bF;bG.lastEditActionCommand=bH;bI.lastInsertModeChanges.changes=[];bI.lastInsertModeChanges.expectCursorActivityForChange=false}};var a5={moveToTopLine:function(bF,bH,bI){var bG=bg(bF).top+bI.repeat-1;return c(bG,a3(bF.getLine(bG)))},moveToMiddleLine:function(bF){var bH=bg(bF);var bG=Math.floor((bH.top+bH.bottom)*0.5);return c(bG,a3(bF.getLine(bG)))},moveToBottomLine:function(bF,bH,bI){var bG=bg(bF).bottom-bI.repeat+1;return c(bG,a3(bF.getLine(bG)))},expandToLine:function(bH,bG,bF){var bI=bG;return c(bI.line+bF.repeat-1,Infinity)},findNext:function(bF,bG,bH){var bK=aK(bF);var bJ=bK.getQuery();if(!bJ){return}var bI=!bH.forward;bI=(bK.isReversed())?!bI:bI;aM(bF,bJ);return bD(bF,bI,bJ,bH.repeat)},goToMark:function(bF,bH,bI,bG){var bK=bG.marks[bI.selectedCharacter];if(bK){var bJ=bK.find();return bI.linewise?{line:bJ.line,ch:a3(bF.getLine(bJ.line))}:bJ}return null},moveToOtherHighlightedEnd:function(bF,bH,bI,bG){if(bG.visualBlock&&bI.sameLine){var bJ=bG.sel;return[aa(bF,c(bJ.anchor.line,bJ.head.ch)),aa(bF,c(bJ.head.line,bJ.anchor.ch))]}else{return([bG.sel.head,bG.sel.anchor])}},jumpToMark:function(bN,bM,bI,bJ){var bH=bM;for(var bK=0;bK<bI.repeat;bK++){var bP=bH;for(var bO in bJ.marks){if(!E(bO)){continue}var bG=bJ.marks[bO].find();var bF=(bI.forward)?aQ(bG,bP):aQ(bP,bG);if(bF){continue}if(bI.linewise&&(bG.line==bP.line)){continue}var bL=bC(bP,bH);var bQ=(bI.forward)?ax(bP,bG,bH):ax(bH,bG,bP);if(bL||bQ){bH=bG}}}if(bI.linewise){bH=c(bH.line,a3(bN.getLine(bH.line)))}return bH},moveByCharacters:function(bI,bG,bF){var bK=bG;var bJ=bF.repeat;var bH=bF.forward?bK.ch+bJ:bK.ch-bJ;return c(bK.line,bH)},moveByLines:function(bL,bK,bG,bH){var bN=bK;var bI=bN.ch;switch(bH.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:bI=bH.lastHPos;break;default:bH.lastHPos=bI}var bF=bG.repeat+(bG.repeatOffset||0);var bO=bG.forward?bN.line+bF:bN.line-bF;var bJ=bL.firstLine();var bM=bL.lastLine();if((bO<bJ&&bN.line==bJ)||(bO>bM&&bN.line==bM)){return}if(bG.toFirstChar){bI=a3(bL.getLine(bO));bH.lastHPos=bI}bH.lastHSPos=bL.charCoords(c(bO,bI),"div").left;return c(bO,bI)},moveByDisplayLines:function(bN,bM,bH,bI){var bO=bM;switch(bI.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:bI.lastHSPos=bN.charCoords(bO,"div").left}var bF=bH.repeat;var bL=bN.findPosV(bO,(bH.forward?bF:-bF),"line",bI.lastHSPos);if(bL.hitSide){if(bH.forward){var bG=bN.charCoords(bL,"div");var bJ={top:bG.top+8,left:bI.lastHSPos};var bL=bN.coordsChar(bJ,"div")}else{var bK=bN.charCoords(c(bN.firstLine(),0),"div");bK.left=bI.lastHSPos;bL=bN.coordsChar(bK,"div")}}bI.lastHPos=bL.ch;return bL},moveByPage:function(bG,bI,bH){var bF=bI;var bJ=bH.repeat;return bG.findPosV(bF,(bH.forward?bJ:-bJ),"page")},moveByParagraph:function(bF,bI,bH){var bG=bH.forward?1:-1;return br(bF,bI,bH.repeat,bG)},moveByScroll:function(bL,bI,bG,bH){var bM=bL.getScrollInfo();var bN=null;var bF=bG.repeat;if(!bF){bF=bM.clientHeight/(2*bL.defaultTextHeight())}var bK=bL.charCoords(bI,"local");bG.repeat=bF;var bN=a5.moveByDisplayLines(bL,bI,bG,bH);if(!bN){return null}var bJ=bL.charCoords(bN,"local");bL.scrollTo(null,bM.top+bJ.top-bK.top);return bN},moveByWords:function(bF,bH,bG){return aF(bF,bH,bG.repeat,!!bG.forward,!!bG.wordEnd,!!bG.bigWord)},moveTillCharacter:function(bG,bH,bI){var bK=bI.repeat;var bJ=bv(bG,bK,bI.forward,bI.selectedCharacter);var bF=bI.forward?-1:1;aG(bF,bI);if(!bJ){return null}bJ.ch+=bF;return bJ},moveToCharacter:function(bF,bH,bG){var bI=bG.repeat;aG(0,bG);return bv(bF,bI,bG.forward,bG.selectedCharacter)||bH},moveToSymbol:function(bF,bH,bG){var bI=bG.repeat;return bw(bF,bI,bG.forward,bG.selectedCharacter)||bH},moveToColumn:function(bF,bI,bH,bG){var bJ=bH.repeat;bG.lastHPos=bJ-1;bG.lastHSPos=bF.charCoords(bI,"div").left;return al(bF,bJ)},moveToEol:function(bF,bK,bJ,bI){var bL=bK;bI.lastHPos=Infinity;var bH=c(bL.line+bJ.repeat-1,Infinity);var bG=bF.clipPos(bH);bG.ch--;bI.lastHSPos=bF.charCoords(bG,"div").left;return bH},moveToFirstNonWhiteSpaceCharacter:function(bF,bG){var bH=bG;return c(bH.line,a3(bF.getLine(bH.line)))},moveToMatchedSymbol:function(bL,bJ){var bM=bJ;var bN=bM.line;var bF=bM.ch;var bK=bL.getLine(bN);var bI;do{bI=bK.charAt(bF++);if(bI&&N(bI)){var bG=bL.getTokenTypeAt(c(bN,bF));if(bG!=="string"&&bG!=="comment"){break}}}while(bI);if(bI){var bH=bL.findMatchingBracket(c(bN,bF));return bH.to}else{return bM}},moveToStartOfLine:function(bG,bF){return c(bF.line,0)},moveToLineOrEdgeOfDocument:function(bF,bG,bH){var bI=bH.forward?bF.lastLine():bF.firstLine();if(bH.repeatIsExplicit){bI=bH.repeat-bF.getOption("firstLineNumber")}return c(bI,a3(bF.getLine(bI)))},textObjectManipulation:function(bN,bL,bH,bI){var bF={"(":")",")":"(","{":"}","}":"{","[":"]","]":"["};var bO={"'":true,'"':true};var bK=bH.selectedCharacter;if(bK=="b"){bK="("}else{if(bK=="B"){bK="{"}}var bM=!bH.textObjectInner;var bJ;if(bF[bK]){bJ=n(bN,bL,bK,bM)}else{if(bO[bK]){bJ=aS(bN,bL,bK,bM)}else{if(bK==="W"){bJ=aH(bN,bM,true,true)}else{if(bK==="w"){bJ=aH(bN,bM,true,false)}else{if(bK==="p"){bJ=br(bN,bL,bH.repeat,0,bM);bH.linewise=true;if(bI.visualMode){if(!bI.visualLine){bI.visualLine=true}}else{var bG=bI.inputState.operatorArgs;if(bG){bG.linewise=true}bJ.end.line--}}else{return null}}}}}if(!bN.state.vim.visualMode){return[bJ.start,bJ.end]}else{return u(bN,bJ.start,bJ.end)}},repeatLastCharacterSearch:function(bH,bK,bJ){var bG=r.lastChararacterSearch;var bM=bJ.repeat;var bI=bJ.forward===bG.forward;var bF=(bG.increment?1:0)*(bI?-1:1);bH.moveH(-bF,"char");bJ.inclusive=bI?true:false;var bL=bv(bH,bM,bI,bG.selectedCharacter);if(!bL){bH.moveH(bF,"char");return bK}bL.ch+=bF;return bL}};function at(bF,bG){a5[bF]=bG}function z(bI,bH){var bF=[];for(var bG=0;bG<bH;bG++){bF.push(bI)}return bF}var K={change:function(bP,bN,bH){var bM,bQ;var bJ=bP.state.vim;r.macroModeState.lastInsertModeChanges.inVisualBlock=bJ.visualBlock;if(!bJ.visualMode){var bK=bH[0].anchor,bO=bH[0].head;bQ=bP.getRange(bK,bO);var bF=bJ.lastEditInputState||{};if(bF.motion=="moveByWords"&&!T(bQ)){var bL=(/\s+$/).exec(bQ);if(bL&&bF.motionArgs&&bF.motionArgs.forward){bO=D(bO,0,-bL[0].length);bQ=bQ.slice(0,-bL[0].length)}}var bG=bO.line-1==bP.lastLine();bP.replaceRange("",bK,bO);if(bN.linewise&&!bG){b.commands.newlineAndIndent(bP);bK.ch=null}bM=bK}else{bQ=bP.getSelection();var bI=z("",bH.length);bP.replaceSelections(bI);bM=ay(bH[0].head,bH[0].anchor)}r.registerController.pushText(bN.registerName,"change",bQ,bN.linewise,bH.length>1);q.enterInsertMode(bP,{head:bM},bP.state.vim)},"delete":function(bM,bK,bF){var bJ,bN;var bH=bM.state.vim;if(!bH.visualBlock){var bI=bF[0].anchor,bL=bF[0].head;if(bK.linewise&&bL.line!=bM.firstLine()&&bI.line==bM.lastLine()&&bI.line==bL.line-1){if(bI.line==bM.firstLine()){bI.ch=0}else{bI=c(bI.line-1,aZ(bM,bI.line-1))}}bN=bM.getRange(bI,bL);bM.replaceRange("",bI,bL);bJ=bI;if(bK.linewise){bJ=a5.moveToFirstNonWhiteSpaceCharacter(bM,bI)}}else{bN=bM.getSelection();var bG=z("",bF.length);bM.replaceSelections(bG);bJ=bF[0].anchor}r.registerController.pushText(bK.registerName,"delete",bN,bK.linewise,bH.visualBlock);return aa(bM,bJ)},indent:function(bM,bL,bF){var bJ=bM.state.vim;var bN=bF[0].anchor.line;var bH=bJ.visualBlock?bF[bF.length-1].anchor.line:bF[0].head.line;var bG=(bJ.visualMode)?bL.repeat:1;if(bL.linewise){bH--}for(var bK=bN;bK<=bH;bK++){for(var bI=0;bI<bG;bI++){bM.indentLine(bK,bL.indentRight)}}return a5.moveToFirstNonWhiteSpaceCharacter(bM,bF[0].anchor)},changeCase:function(bQ,bP,bF,bM,bJ){var bG=bQ.getSelections();var bH=[];var bI=bP.toLower;for(var bK=0;bK<bG.length;bK++){var bN=bG[bK];var bR="";if(bI===true){bR=bN.toLowerCase()}else{if(bI===false){bR=bN.toUpperCase()}else{for(var bL=0;bL<bN.length;bL++){var bO=bN.charAt(bL);bR+=B(bO)?bO.toLowerCase():bO.toUpperCase()}}}bH.push(bR)}bQ.replaceSelections(bH);if(bP.shouldMoveCursor){return bJ}else{if(!bQ.state.vim.visualMode&&bP.linewise&&bF[0].anchor.line+1==bF[0].head.line){return a5.moveToFirstNonWhiteSpaceCharacter(bQ,bM)}else{if(bP.linewise){return bM}else{return ay(bF[0].anchor,bF[0].head)}}}},yank:function(bF,bK,bG,bI){var bH=bF.state.vim;var bL=bF.getSelection();var bJ=bH.visualMode?ay(bH.sel.anchor,bH.sel.head,bG[0].head,bG[0].anchor):bI;r.registerController.pushText(bK.registerName,"yank",bL,bK.linewise,bH.visualBlock);return bJ}};function bm(bF,bG){K[bF]=bG}var q={jumpListWalk:function(bF,bH,bI){if(bI.visualMode){return}var bK=bH.repeat;var bJ=bH.forward;var bG=r.jumpList;var bM=bG.move(bF,bJ?bK:-bK);var bL=bM?bM.find():undefined;bL=bL?bL:bF.getCursor();bF.setCursor(bL)},scroll:function(bN,bH,bJ){if(bJ.visualMode){return}var bF=bH.repeat||1;var bM=bN.defaultTextHeight();var bL=bN.getScrollInfo().top;var bO=bM*bF;var bK=bH.forward?bL+bO:bL-bO;var bP=C(bN.getCursor());var bI=bN.charCoords(bP,"local");if(bH.forward){if(bK>bI.top){bP.line+=(bK-bI.top)/bM;bP.line=Math.ceil(bP.line);bN.setCursor(bP);bI=bN.charCoords(bP,"local");bN.scrollTo(null,bI.top)}else{bN.scrollTo(null,bK)}}else{var bG=bK+bN.getScrollInfo().clientHeight;if(bG<bI.bottom){bP.line-=(bI.bottom-bG)/bM;bP.line=Math.floor(bP.line);bN.setCursor(bP);bI=bN.charCoords(bP,"local");bN.scrollTo(null,bI.bottom-bN.getScrollInfo().clientHeight)}else{bN.scrollTo(null,bK)}}},scrollToCursor:function(bG,bH){var bK=bG.getCursor().line;var bI=bG.charCoords(c(bK,0),"local");var bF=bG.getScrollInfo().clientHeight;var bL=bI.top;var bJ=bI.bottom-bL;switch(bH.position){case"center":bL=bL-(bF/2)+bJ;break;case"bottom":bL=bL-bF+bJ*1.4;break;case"top":bL=bL+bJ*0.4;break}bG.scrollTo(null,bL)},replayMacro:function(bF,bG,bH){var bI=bG.selectedCharacter;var bJ=bG.repeat;var bK=r.macroModeState;if(bI=="@"){bI=bK.latestRegister}while(bJ--){H(bF,bH,bK,bI)}},enterMacroRecordMode:function(bF,bG){var bI=r.macroModeState;var bH=bG.selectedCharacter;bI.enterMacroRecordMode(bF,bH)},enterInsertMode:function(bG,bH,bI){if(bG.getOption("readOnly")){return}bI.insertMode=true;bI.insertModeRepeat=bH&&bH.repeat||1;var bK=(bH)?bH.insertAt:null;var bL=bI.sel;var bJ=bH.head||bG.getCursor("head");var bF=bG.listSelections().length;if(bK=="eol"){bJ=c(bJ.line,aZ(bG,bJ.line))}else{if(bK=="charAfter"){bJ=D(bJ,0,1)}else{if(bK=="firstNonBlank"){bJ=a5.moveToFirstNonWhiteSpaceCharacter(bG,bJ)}else{if(bK=="startOfSelectedArea"){if(!bI.visualBlock){if(bL.head.line<bL.anchor.line){bJ=bL.head}else{bJ=c(bL.anchor.line,0)}}else{bJ=c(Math.min(bL.head.line,bL.anchor.line),Math.min(bL.head.ch,bL.anchor.ch));bF=Math.abs(bL.head.line-bL.anchor.line)+1}}else{if(bK=="endOfSelectedArea"){if(!bI.visualBlock){if(bL.head.line>=bL.anchor.line){bJ=D(bL.head,0,1)}else{bJ=c(bL.anchor.line,0)}}else{bJ=c(Math.min(bL.head.line,bL.anchor.line),Math.max(bL.head.ch+1,bL.anchor.ch));bF=Math.abs(bL.head.line-bL.anchor.line)+1}}else{if(bK=="inplace"){if(bI.visualMode){return}}}}}}}bG.setOption("keyMap","vim-insert");bG.setOption("disableInput",false);if(bH&&bH.replace){bG.toggleOverwrite(true);bG.setOption("keyMap","vim-replace");b.signal(bG,"vim-mode-change",{mode:"replace"})}else{bG.setOption("keyMap","vim-insert");b.signal(bG,"vim-mode-change",{mode:"insert"})}if(!r.macroModeState.isPlaying){bG.on("change",bl);b.on(bG.getInputField(),"keydown",W)}if(bI.visualMode){aV(bG)}aW(bG,bJ,bF)},toggleVisualMode:function(bF,bG,bH){var bK=bG.repeat;var bI=bF.getCursor();var bJ;if(!bH.visualMode){bH.visualMode=true;bH.visualLine=!!bG.linewise;bH.visualBlock=!!bG.blockwise;bJ=aa(bF,c(bI.line,bI.ch+bK-1),true);bH.sel={anchor:bI,head:bJ};b.signal(bF,"vim-mode-change",{mode:"visual",subMode:bH.visualLine?"linewise":bH.visualBlock?"blockwise":""});M(bF);aT(bF,bH,"<",ay(bI,bJ));aT(bF,bH,">",bd(bI,bJ))}else{if(bH.visualLine^bG.linewise||bH.visualBlock^bG.blockwise){bH.visualLine=!!bG.linewise;bH.visualBlock=!!bG.blockwise;b.signal(bF,"vim-mode-change",{mode:"visual",subMode:bH.visualLine?"linewise":bH.visualBlock?"blockwise":""});M(bF)}else{aV(bF)}}},reselectLastSelection:function(bF,bK,bH){var bG=bH.lastSelection;if(bH.visualMode){bk(bF,bH)}if(bG){var bI=bG.anchorMark.find();var bJ=bG.headMark.find();if(!bI||!bJ){return}bH.sel={anchor:bI,head:bJ};bH.visualMode=true;bH.visualLine=bG.visualLine;bH.visualBlock=bG.visualBlock;M(bF);aT(bF,bH,"<",ay(bI,bJ));aT(bF,bH,">",bd(bI,bJ));b.signal(bF,"vim-mode-change",{mode:"visual",subMode:bH.visualLine?"linewise":bH.visualBlock?"blockwise":""})}},joinLines:function(bM,bG,bI){var bL,bO;if(bI.visualMode){bL=bM.getCursor("anchor");bO=bM.getCursor("head");if(aQ(bO,bL)){var bK=bO;bO=bL;bL=bK}bO.ch=aZ(bM,bO.line)-1}else{var bF=Math.max(bG.repeat,2);bL=bM.getCursor();bO=aa(bM,c(bL.line+bF-1,Infinity))}var bH=0;for(var bJ=bL.line;bJ<bO.line;bJ++){bH=aZ(bM,bL.line);var bK=c(bL.line+1,aZ(bM,bL.line+1));var bP=bM.getRange(bL,bK);bP=bP.replace(/\n\s*/g," ");bM.replaceRange(bP,bL,bK)}var bN=c(bL.line,bH);if(bI.visualMode){aV(bM,false)}bM.setCursor(bN)},newLineAndEnterInsertMode:function(bF,bG,bH){bH.insertMode=true;var bI=C(bF.getCursor());if(bI.line===bF.firstLine()&&!bG.after){bF.replaceRange("\n",c(bF.firstLine(),0));bF.setCursor(bF.firstLine(),0)}else{bI.line=(bG.after)?bI.line:bI.line-1;bI.ch=aZ(bF,bI.line);bF.setCursor(bI);var bJ=b.commands.newlineAndIndentContinueComment||b.commands.newlineAndIndent;bJ(bF)}this.enterInsertMode(bF,{repeat:bG.repeat},bH)},paste:function(bT,bS,b1){var bM=C(bT.getCursor());var bG=r.registerController.getRegister(bS.registerName);var bW=bG.toString();if(!bW){return}if(bS.matchIndent){var bY=bT.getOption("tabSize");var bN=function(b8){var b7=(b8.split("\t").length-1);var b6=(b8.split(" ").length-1);return b7*bY+b6*1};var b3=bT.getLine(bT.getCursor().line);var bV=bN(b3.match(/^\s*/)[0]);var bF=bW.replace(/\n$/,"");var bK=bW!==bF;var bQ=bN(bW.match(/^\s*/)[0]);var bW=bF.replace(/^\s*/gm,function(b6){var b7=bV+(bN(b6)-bQ);if(b7<0){return""}else{if(bT.getOption("indentWithTabs")){var b8=Math.floor(b7/bY);return Array(b8+1).join("\t")}else{return Array(b7+1).join(" ")}}});bW+=bK?"\n":""}if(bS.repeat>1){var bW=Array(bS.repeat+1).join(bW)}var bP=bG.linewise;var bR=bG.blockwise;if(bP){if(b1.visualMode){bW=b1.visualLine?bW.slice(0,-1):"\n"+bW.slice(0,bW.length-1)+"\n"}else{if(bS.after){bW="\n"+bW.slice(0,bW.length-1);bM.ch=aZ(bT,bM.line)}else{bM.ch=0}}}else{if(bR){bW=bW.split("\n");for(var b2=0;b2<bW.length;b2++){bW[b2]=(bW[b2]=="")?" ":bW[b2]}}bM.ch+=bS.after?1:0}var bJ;var bX;if(b1.visualMode){b1.lastPastedText=bW;var bI;var b5=ba(bT,b1);var bZ=b5[0];var bH=b5[1];var b0=bT.getSelection();var bO=bT.listSelections();var bL=new Array(bO.length).join("1").split("1");if(b1.lastSelection){bI=b1.lastSelection.headMark.find()}r.registerController.unnamedRegister.setText(b0);if(bR){bT.replaceSelections(bL);bH=c(bZ.line+bW.length-1,bZ.ch);bT.setCursor(bZ);F(bT,bH);bT.replaceSelections(bW);bJ=bZ}else{if(b1.visualBlock){bT.replaceSelections(bL);bT.setCursor(bZ);bT.replaceRange(bW,bZ,bZ);bJ=bZ}else{bT.replaceRange(bW,bZ,bH);bJ=bT.posFromIndex(bT.indexFromPos(bZ)+bW.length-1)}}if(bI){b1.lastSelection.headMark=bT.setBookmark(bI)}if(bP){bJ.ch=0}}else{if(bR){bT.setCursor(bM);for(var b2=0;b2<bW.length;b2++){var bU=bM.line+b2;if(bU>bT.lastLine()){bT.replaceRange("\n",c(bU,0))}var b4=aZ(bT,bU);if(b4<bM.ch){a0(bT,bU,bM.ch)}}bT.setCursor(bM);F(bT,c(bM.line+bW.length-1,bM.ch));bT.replaceSelections(bW);bJ=bM}else{bT.replaceRange(bW,bM);if(bP&&bS.after){bJ=c(bM.line+1,a3(bT.getLine(bM.line+1)))}else{if(bP&&!bS.after){bJ=c(bM.line,a3(bT.getLine(bM.line)))}else{if(!bP&&bS.after){bX=bT.indexFromPos(bM);bJ=bT.posFromIndex(bX+bW.length-1)}else{bX=bT.indexFromPos(bM);bJ=bT.posFromIndex(bX+bW.length)}}}}}if(b1.visualMode){aV(bT,false)}bT.setCursor(bJ)},undo:function(bF,bG){bF.operation(function(){az(bF,b.commands.undo,bG.repeat)();bF.setCursor(bF.getCursor("anchor"))})},redo:function(bF,bG){az(bF,b.commands.redo,bG.repeat)()},setRegister:function(bH,bF,bG){bG.inputState.registerName=bF.selectedCharacter},setMark:function(bF,bG,bH){var bI=bG.selectedCharacter;aT(bF,bH,bI,bF.getCursor())},replace:function(bN,bH,bJ){var bI=bH.selectedCharacter;var bM=bN.getCursor();var bL;var bO;var bG=bN.listSelections();if(bJ.visualMode){bM=bN.getCursor("start");bO=bN.getCursor("end")}else{var bP=bN.getLine(bM.line);bL=bM.ch+bH.repeat;if(bL>bP.length){bL=bP.length}bO=c(bM.line,bL)}if(bI=="\n"){if(!bJ.visualMode){bN.replaceRange("",bM,bO)}(b.commands.newlineAndIndentContinueComment||b.commands.newlineAndIndent)(bN)}else{var bF=bN.getRange(bM,bO);bF=bF.replace(/[^\n]/g,bI);if(bJ.visualBlock){var bK=new Array(bN.getOption("tabSize")+1).join(" ");bF=bN.getSelection();bF=bF.replace(/\t/g,bK).replace(/[^\n]/g,bI).split("\n");bN.replaceSelections(bF)}else{bN.replaceRange(bF,bM,bO)}if(bJ.visualMode){bM=aQ(bG[0].anchor,bG[0].head)?bG[0].anchor:bG[0].head;bN.setCursor(bM);aV(bN,false)}else{bN.setCursor(D(bO,0,-1))}}},incrementNumberToken:function(bP,bG){var bQ=bP.getCursor();var bL=bP.getLine(bQ.line);var bS=/-?\d+/g;var bK;var bF;var bJ;var bR;var bH;while((bK=bS.exec(bL))!==null){bH=bK[0];bF=bK.index;bJ=bF+bH.length;if(bQ.ch<bJ){break}}if(!bG.backtrack&&(bJ<=bQ.ch)){return}if(bH){var bO=bG.increase?1:-1;var bI=parseInt(bH)+(bO*bG.repeat);var bN=c(bQ.line,bF);var bM=c(bQ.line,bJ);bR=bI.toString();bP.replaceRange(bR,bN,bM)}else{return}bP.setCursor(c(bQ.line,bF+bR.length-1))},repeatLastEdit:function(bG,bH,bI){var bF=bI.lastEditInputState;if(!bF){return}var bJ=bH.repeat;if(bJ&&bH.repeatIsExplicit){bI.lastEditInputState.repeatOverride=bJ}else{bJ=bI.lastEditInputState.repeatOverride||bJ}y(bG,bI,bJ,false)},exitInsertMode:w};function bt(bF,bG){q[bF]=bG}function aa(bG,bK,bI){var bH=Math.min(Math.max(bG.firstLine(),bK.line),bG.lastLine());var bF=aZ(bG,bH)-1;bF=(bI)?bF+1:bF;var bJ=Math.min(Math.max(0,bK.ch),bF);return c(bH,bJ)}function bn(bG){var bF={};for(var bH in bG){if(bG.hasOwnProperty(bH)){bF[bH]=bG[bH]}}return bF}function D(bG,bF,bH){if(typeof bF==="object"){bH=bF.ch;bF=bF.line}return c(bG.line+bF,bG.ch+bH)}function bi(bF,bG){return{line:bG.line-bF.line,ch:bG.line-bF.line}}function bp(bN,bL,bF,bJ){var bI,bM=[],bK=[];for(var bH=0;bH<bL.length;bH++){var bG=bL[bH];if(bF=="insert"&&bG.context!="insert"||bG.context&&bG.context!=bF||bJ.operator&&bG.type=="action"||!(bI=R(bN,bG.keys))){continue}if(bI=="partial"){bM.push(bG)}if(bI=="full"){bK.push(bG)}}return{partial:bM.length&&bM,full:bK.length&&bK}}function R(bI,bF){if(bF.slice(-11)=="<character>"){var bG=bF.length-11;var bJ=bI.slice(0,bG);var bH=bF.slice(0,bG);return bJ==bH&&bI.length>bG?"full":bH.indexOf(bJ)==0?"partial":false}else{return bI==bF?"full":bF.indexOf(bI)==0?"partial":false}}function Q(bH){var bG=/^.*(<[\w\-]+>)$/.exec(bH);var bF=bG?bG[1]:bH.slice(-1);if(bF.length>1){switch(bF){case"<CR>":bF="\n";break;case"<Space>":bF=" ";break;default:break}}return bF}function az(bF,bG,bH){return function(){for(var bI=0;bI<bH;bI++){bG(bF)}}}function C(bF){return c(bF.line,bF.ch)}function bC(bG,bF){return bG.ch==bF.ch&&bG.line==bF.line}function aQ(bG,bF){if(bG.line<bF.line){return true}if(bG.line==bF.line&&bG.ch<bF.ch){return true}return false}function ay(bG,bF){if(arguments.length>2){bF=ay.apply(undefined,Array.prototype.slice.call(arguments,1))}return aQ(bG,bF)?bG:bF}function bd(bG,bF){if(arguments.length>2){bF=bd.apply(undefined,Array.prototype.slice.call(arguments,1))}return aQ(bG,bF)?bF:bG}function ax(bI,bH,bG){var bJ=aQ(bI,bH);var bF=aQ(bH,bG);return bJ&&bF}function aZ(bF,bG){return bF.getLine(bG).length}function bc(bF){if(bF.trim){return bF.trim()}return bF.replace(/^\s+|\s+$/g,"")}function h(bF){return bF.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function a0(bF,bJ,bI){var bH=aZ(bF,bJ);var bG=new Array(bI-bH+1).join(" ");bF.setCursor(c(bJ,bH));bF.replaceRange(bG,bF.getCursor())}function F(bN,bG){var bI=[],bH=bN.listSelections();var bJ=C(bN.clipPos(bG));var bY=!bC(bG,bJ);var bL=bN.getCursor("head");var bX=v(bH,bL);var bO=bC(bH[bX].head,bH[bX].anchor);var bW=bH.length-1;var bM=bW-bX>bX?bW:0;var bK=bH[bM].anchor;var bT=Math.min(bK.line,bJ.line);var bF=Math.max(bK.line,bJ.line);var bP=bK.ch,bQ=bJ.ch;var bV=bH[bM].head.ch-bP;var bS=bQ-bP;if(bV>0&&bS<=0){bP++;if(!bY){bQ--}}else{if(bV<0&&bS>=0){bP--;if(!bO){bQ++}}else{if(bV<0&&bS==-1){bP--;bQ++}}}for(var bR=bT;bR<=bF;bR++){var bU={anchor:new c(bR,bP),head:new c(bR,bQ)};bI.push(bU)}bX=bJ.line==bF?bI.length-1:0;bN.setSelections(bI);bG.ch=bQ;bK.ch=bP;return bK}function aW(bG,bI,bF){var bK=[];for(var bH=0;bH<bF;bH++){var bJ=D(bI,bH,0);bK.push({anchor:bJ,head:bJ})}bG.setSelections(bK,0)}function v(bG,bK,bF){for(var bH=0;bH<bG.length;bH++){var bI=bF!="head"&&bC(bG[bH].anchor,bK);var bJ=bF!="anchor"&&bC(bG[bH].head,bK);if(bI||bJ){return bH}}return -1}function ba(bG,bI){var bH=bI.lastSelection;var bF=function(){var bL=bG.listSelections();var bO=bL[0];var bK=bL[bL.length-1];var bM=aQ(bO.anchor,bO.head)?bO.anchor:bO.head;var bN=aQ(bK.anchor,bK.head)?bK.head:bK.anchor;return[bM,bN]};var bJ=function(){var bU=bG.getCursor();var bV=bG.getCursor();var bP=bH.visualBlock;if(bP){var bM=bP.width;var bW=bP.height;bV=c(bU.line+bW,bU.ch+bM);var bN=[];for(var bQ=bU.line;bQ<bV.line;bQ++){var bR=c(bQ,bU.ch);var bT=c(bQ,bV.ch);var bS={anchor:bR,head:bT};bN.push(bS)}bG.setSelections(bN)}else{var bL=bH.anchorMark.find();var bO=bH.headMark.find();var bX=bO.line-bL.line;var bK=bO.ch-bL.ch;bV={line:bV.line+bX,ch:bX?bV.ch:bK+bV.ch};if(bH.visualLine){bU=c(bU.line,0);bV=c(bV.line,aZ(bG,bV.line))}bG.setSelection(bU,bV)}return[bU,bV]};if(!bI.visualMode){return bJ()}else{return bF()}}function bk(bF,bG){var bH=bG.sel.anchor;var bI=bG.sel.head;if(bG.lastPastedText){bI=bF.posFromIndex(bF.indexFromPos(bH)+bG.lastPastedText.length);bG.lastPastedText=null}bG.lastSelection={anchorMark:bF.setBookmark(bH),headMark:bF.setBookmark(bI),anchor:C(bH),head:C(bI),visualMode:bG.visualMode,visualLine:bG.visualLine,visualBlock:bG.visualBlock}}function u(bF,bL,bG){var bK=bF.state.vim.sel;var bJ=bK.head;var bH=bK.anchor;var bI;if(aQ(bG,bL)){bI=bG;bG=bL;bL=bI}if(aQ(bJ,bH)){bJ=ay(bL,bJ);bH=bd(bH,bG)}else{bH=ay(bL,bH);bJ=bd(bJ,bG);bJ=D(bJ,0,-1);if(bJ.ch==-1&&bJ.line!=bF.firstLine()){bJ=c(bJ.line-1,aZ(bF,bJ.line-1))}}return[bH,bJ]}function M(bF,bI,bJ){var bG=bF.state.vim;bI=bI||bG.sel;var bJ=bJ||bG.visualLine?"line":bG.visualBlock?"block":"char";var bH=bE(bF,bI,bJ);bF.setSelections(bH.ranges,bH.primary);ad(bF)}function bE(bT,bI,bO,bH){var bQ=C(bI.head);var bN=C(bI.anchor);if(bO=="char"){var bR=!bH&&!aQ(bI.head,bI.anchor)?1:0;var bJ=aQ(bI.head,bI.anchor)?1:0;bQ=D(bI.head,0,bR);bN=D(bI.anchor,0,bJ);return{ranges:[{anchor:bN,head:bQ}],primary:0}}else{if(bO=="line"){if(!aQ(bI.head,bI.anchor)){bN.ch=0;var bS=bT.lastLine();if(bQ.line>bS){bQ.line=bS}bQ.ch=aZ(bT,bQ.line)}else{bQ.ch=0;bN.ch=aZ(bT,bN.line)}return{ranges:[{anchor:bN,head:bQ}],primary:0}}else{if(bO=="block"){var bP=Math.min(bN.line,bQ.line),bL=Math.min(bN.ch,bQ.ch),bF=Math.max(bN.line,bQ.line),bU=Math.max(bN.ch,bQ.ch)+1;var bV=bF-bP+1;var bK=bQ.line==bP?0:bV-1;var bG=[];for(var bM=0;bM<bV;bM++){bG.push({anchor:c(bP+bM,bL),head:c(bP+bM,bU)})}return{ranges:bG,primary:bK}}}}}function f(bF){var bG=bF.getCursor("head");if(bF.getSelection().length==1){bG=ay(bG,bF.getCursor("anchor"))}return bG}function aV(bF,bH){var bG=bF.state.vim;if(bH!==false){bF.setCursor(aa(bF,bG.sel.head))}bk(bF,bG);bG.visualMode=false;bG.visualLine=false;bG.visualBlock=false;b.signal(bF,"vim-mode-change",{mode:"normal"});if(bG.fakeCursor){bG.fakeCursor.clear()}}function an(bG,bF,bK){var bJ=bG.getRange(bF,bK);if(/\n\s*$/.test(bJ)){var bI=bJ.split("\n");bI.pop();var bH;for(var bH=bI.pop();bI.length>0&&bH&&T(bH);bH=bI.pop()){bK.line--;bK.ch=0}if(bH){bK.line--;bK.ch=aZ(bG,bK.line)}else{bK.ch=0}}}function bh(bG,bF,bH){bF.ch=0;bH.ch=0;bH.line++}function a3(bG){if(!bG){return 0}var bF=bG.search(/\S/);return bF==-1?bG.length:bF}function aH(bL,bK,bH,bJ,bQ){var bN=f(bL);var bR=bL.getLine(bN.line);var bM=bN.ch;var bI=bQ?aq[0]:bz[0];while(!bI(bR.charAt(bM))){bM++;if(bM>=bR.length){return null}}if(bJ){bI=bz[0]}else{bI=aq[0];if(!bI(bR.charAt(bM))){bI=aq[1]}}var bG=bM,bF=bM;while(bI(bR.charAt(bG))&&bG<bR.length){bG++}while(bI(bR.charAt(bF))&&bF>=0){bF--}bF++;if(bK){var bO=bG;while(/\s/.test(bR.charAt(bG))&&bG<bR.length){bG++}if(bO==bG){var bP=bF;while(/\s/.test(bR.charAt(bF-1))&&bF>0){bF--}if(!bF){bF=bP}}}return{start:c(bN.line,bF),end:c(bN.line,bG)}}function bj(bF,bG,bH){if(!bC(bG,bH)){r.jumpList.add(bF,bG,bH)}}function aG(bF,bG){r.lastChararacterSearch.increment=bF;r.lastChararacterSearch.forward=bG.forward;r.lastChararacterSearch.selectedCharacter=bG.selectedCharacter}var S={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"};var a1={bracket:{isComplete:function(bF){if(bF.nextCh===bF.symb){bF.depth++;if(bF.depth>=1){return true}}else{if(bF.nextCh===bF.reverseSymb){bF.depth--}}return false}},section:{init:function(bF){bF.curMoveThrough=true;bF.symb=(bF.forward?"]":"[")===bF.symb?"{":"}"},isComplete:function(bF){return bF.index===0&&bF.nextCh===bF.symb}},comment:{isComplete:function(bG){var bF=bG.lastCh==="*"&&bG.nextCh==="/";bG.lastCh=bG.nextCh;return bF}},method:{init:function(bF){bF.symb=(bF.symb==="m"?"{":"}");bF.reverseSymb=bF.symb==="{"?"}":"{"},isComplete:function(bF){if(bF.nextCh===bF.symb){return true}return false}},preprocess:{init:function(bF){bF.index=0},isComplete:function(bG){if(bG.nextCh==="#"){var bF=bG.lineText.match(/#(\w+)/)[1];if(bF==="endif"){if(bG.forward&&bG.depth===0){return true}bG.depth++}else{if(bF==="if"){if(!bG.forward&&bG.depth===0){return true}bG.depth--}}if(bF==="else"&&bG.depth===0){return true}}return false}}};function bw(bO,bG,bJ,bH){var bR=C(bO.getCursor());var bP=bJ?1:-1;var bI=bJ?bO.lineCount():-1;var bN=bR.ch;var bT=bR.line;var bM=bO.getLine(bT);var bF={lineText:bM,nextCh:bM.charAt(bN),lastCh:null,index:bN,symb:bH,reverseSymb:(bJ?{")":"(","}":"{"}:{"(":")","{":"}"})[bH],forward:bJ,depth:0,curMoveThrough:false};var bK=S[bH];if(!bK){return bR}var bS=a1[bK].init;var bQ=a1[bK].isComplete;if(bS){bS(bF)}while(bT!==bI&&bG){bF.index+=bP;bF.nextCh=bF.lineText.charAt(bF.index);if(!bF.nextCh){bT+=bP;bF.lineText=bO.getLine(bT)||"";if(bP>0){bF.index=0}else{var bL=bF.lineText.length;bF.index=(bL>0)?(bL-1):0}bF.nextCh=bF.lineText.charAt(bF.index)}if(bQ(bF)){bR.line=bT;bR.ch=bF.index;bG--}}if(bF.nextCh||bF.curMoveThrough){return c(bT,bF.index)}return bR}function by(bP,bQ,bI,bN,bO){var bJ=bQ.line;var bM=bQ.ch;var bT=bP.getLine(bJ);var bG=bI?1:-1;var bK=bN?bz:aq;if(bO&&bT==""){bJ+=bG;bT=bP.getLine(bJ);if(!g(bP,bJ)){return null}bM=(bI)?0:bT.length}while(true){if(bO&&bT==""){return{from:0,to:0,line:bJ}}var bL=(bG>0)?bT.length:-1;var bS=bL,bR=bL;while(bM!=bL){var bF=false;for(var bH=0;bH<bK.length&&!bF;++bH){if(bK[bH](bT.charAt(bM))){bS=bM;while(bM!=bL&&bK[bH](bT.charAt(bM))){bM+=bG}bR=bM;bF=bS!=bR;if(bS==bQ.ch&&bJ==bQ.line&&bR==bS+bG){continue}else{return{from:Math.min(bS,bR+1),to:Math.max(bS,bR),line:bJ}}}}if(!bF){bM+=bG}}bJ+=bG;if(!g(bP,bJ)){return null}bT=bP.getLine(bJ);bM=(bG>0)?0:bT.length}throw new Error("The impossible happened.")}function aF(bP,bR,bG,bK,bT,bN){var bL=C(bR);var bM=[];if(bK&&!bT||!bK&&bT){bG++}var bO=!(bK&&bT);for(var bI=0;bI<bG;bI++){var bF=by(bP,bR,bK,bN,bO);if(!bF){var bH=aZ(bP,bP.lastLine());bM.push(bK?{line:bP.lastLine(),from:bH,to:bH}:{line:0,from:0,to:0});break}bM.push(bF);bR=c(bF.line,bK?(bF.to-1):bF.from)}var bJ=bM.length!=bG;var bQ=bM[0];var bS=bM.pop();if(bK&&!bT){if(!bJ&&(bQ.from!=bL.ch||bQ.line!=bL.line)){bS=bM.pop()}return c(bS.line,bS.from)}else{if(bK&&bT){return c(bS.line,bS.to-1)}else{if(!bK&&bT){if(!bJ&&(bQ.to!=bL.ch||bQ.line!=bL.line)){bS=bM.pop()}return c(bS.line,bS.to)}else{return c(bS.line,bS.from)}}}}function bv(bK,bG,bI,bJ){var bM=bK.getCursor();var bF=bM.ch;var bL;for(var bH=0;bH<bG;bH++){var bN=bK.getLine(bM.line);bL=be(bF,bN,bJ,bI,true);if(bL==-1){return null}bF=bL}return c(bK.getCursor().line,bL)}function al(bF,bH){var bG=bF.getCursor().line;return aa(bF,c(bG,bH-1))}function aT(bF,bG,bH,bI){if(!J(bH,aI)){return}if(bG.marks[bH]){bG.marks[bH].clear()}bG.marks[bH]=bF.setBookmark(bI)}function be(bK,bG,bJ,bH,bI){var bF;if(bH){bF=bG.indexOf(bJ,bK+1);if(bF!=-1&&!bI){bF-=1}}else{bF=bG.lastIndexOf(bJ,bK-1);if(bF!=-1&&!bI){bF+=1}}return bF}function br(bT,bQ,bG,bH,bS){var bU=bQ.line;var bL=bT.firstLine();var bR=bT.lastLine();var bF,bI,bO=bU;function bN(bV){return !bT.getLine(bV)}function bP(bW,bV,bX){if(bX){return bN(bW)!=bN(bW+bV)}return !bN(bW)&&bN(bW+bV)}if(bH){while(bL<=bO&&bO<=bR&&bG>0){if(bP(bO,bH)){bG--}bO+=bH}return new c(bO,0)}var bK=bT.state.vim;if(bK.visualLine&&bP(bU,1,true)){var bM=bK.sel.anchor;if(bP(bM.line,-1,true)){if(!bS||bM.line!=bU){bU+=1}}}var bJ=bN(bU);for(bO=bU;bO<=bR&&bG;bO++){if(bP(bO,1,true)){if(!bS||bN(bO)!=bJ){bG--}}}bI=new c(bO,0);if(bO>bR&&!bJ){bJ=true}else{bS=false}for(bO=bU;bO>bL;bO--){if(!bS||bN(bO)==bJ||bO==bU){if(bP(bO,-1,true)){break}}}bF=new c(bO,0);return{start:bF,end:bI}}function n(bP,bN,bH,bO){var bQ=bN,bG,bJ;var bM=({"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/})[bH];var bI=({"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{"})[bH];var bF=bP.getLine(bQ.line).charAt(bQ.ch);var bK=bF===bI?1:0;bG=bP.scanForBracket(c(bQ.line,bQ.ch+bK),-1,null,{bracketRegex:bM});bJ=bP.scanForBracket(c(bQ.line,bQ.ch+bK),1,null,{bracketRegex:bM});if(!bG||!bJ){return{start:bQ,end:bQ}}bG=bG.pos;bJ=bJ.pos;if((bG.line==bJ.line&&bG.ch>bJ.ch)||(bG.line>bJ.line)){var bL=bG;bG=bJ;bJ=bL}if(bO){bJ.ch+=1}else{bG.ch+=1}return{start:bG,end:bJ}}function aS(bO,bM,bH,bN){var bP=C(bM);var bQ=bO.getLine(bP.line);var bL=bQ.split("");var bG,bI,bJ,bK;var bF=bL.indexOf(bH);if(bP.ch<bF){bP.ch=bF}else{if(bF<bP.ch&&bL[bP.ch]==bH){bI=bP.ch;--bP.ch}}if(bL[bP.ch]==bH&&!bI){bG=bP.ch+1}else{for(bJ=bP.ch;bJ>-1&&!bG;bJ--){if(bL[bJ]==bH){bG=bJ+1}}}if(bG&&!bI){for(bJ=bG,bK=bL.length;bJ<bK&&!bI;bJ++){if(bL[bJ]==bH){bI=bJ}}}if(!bG||!bI){return{start:bP,end:bP}}if(bN){--bG;++bI}return{start:c(bP.line,bG),end:c(bP.line,bI)}}aN("pcre",true,"boolean");function ae(){}ae.prototype={getQuery:function(){return r.query},setQuery:function(bF){r.query=bF},getOverlay:function(){return this.searchOverlay},setOverlay:function(bF){this.searchOverlay=bF},isReversed:function(){return r.isReversed},setReversed:function(bF){r.isReversed=bF},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(bF){this.annotate=bF}};function aK(bF){var bG=bF.state.vim;return bG.searchState_||(bG.searchState_=new ae())}function ac(bF,bI,bJ,bG,bH){if(bF.openDialog){bF.openDialog(bI,bG,{bottom:true,value:bH.value,onKeyDown:bH.onKeyDown,onKeyUp:bH.onKeyUp,selectValueOnOpen:false})}else{bG(prompt(bJ,""))}}function x(bH){var bG=am(bH)||[];if(!bG.length){return[]}var bI=[];if(bG[0]!==0){return}for(var bF=0;bF<bG.length;bF++){if(typeof bG[bF]=="number"){bI.push(bH.substring(bG[bF]+1,bG[bF+1]))}}return bI}function am(bI){var bG=false;var bH=[];for(var bF=0;bF<bI.length;bF++){var bJ=bI.charAt(bF);if(!bG&&bJ=="/"){bH.push(bF)}bG=!bG&&(bJ=="\\")}return bH}function bu(bM){var bN="|(){";var bJ="}";var bK=false;var bG=[];for(var bH=-1;bH<bM.length;bH++){var bL=bM.charAt(bH)||"";var bF=bM.charAt(bH+1)||"";var bI=(bF&&bN.indexOf(bF)!=-1);if(bK){if(bL!=="\\"||!bI){bG.push(bL)}bK=false}else{if(bL==="\\"){bK=true;if(bF&&bJ.indexOf(bF)!=-1){bI=true}if(!bI||bF==="\\"){bG.push(bL)}}else{bG.push(bL);if(bI&&bF!=="\\"){bG.push("\\")}}}}return bG.join("")}var a9={"\\n":"\n","\\r":"\r","\\t":"\t"};function bx(bI){var bH=false;var bF=[];for(var bG=-1;bG<bI.length;bG++){var bK=bI.charAt(bG)||"";var bJ=bI.charAt(bG+1)||"";if(a9[bK+bJ]){bF.push(a9[bK+bJ]);bG++}else{if(bH){bF.push(bK);bH=false}else{if(bK==="\\"){bH=true;if((ai(bJ)||bJ==="$")){bF.push("$")}else{if(bJ!=="/"&&bJ!=="\\"){bF.push("\\")}}}else{if(bK==="$"){bF.push("$")}bF.push(bK);if(bJ==="/"){bF.push("\\")}}}}}return bF.join("")}var af={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"\t"};function ah(bJ){var bI=new b.StringStream(bJ);var bG=[];while(!bI.eol()){while(bI.peek()&&bI.peek()!="\\"){bG.push(bI.next())}var bF=false;for(var bH in af){if(bI.match(bH,true)){bF=true;bG.push(af[bH]);break}}if(!bF){bG.push(bI.next())}}return bG.join("")}function aC(bJ,bH,bM){var bL=r.registerController.getRegister("/");bL.setText(bJ);if(bJ instanceof RegExp){return bJ}var bK=am(bJ);var bN;var bG;if(!bK.length){bN=bJ}else{bN=bJ.substring(0,bK[0]);var bF=bJ.substring(bK[0]);bG=(bF.indexOf("i")!=-1)}if(!bN){return null}if(!o("pcre")){bN=bu(bN)}if(bM){bH=(/^[^A-Z]*$/).test(bN)}var bI=new RegExp(bN,(bH||bG)?"i":undefined);return bI}function bq(bF,bG){if(bF.openNotification){bF.openNotification('<span style="color: red">'+bG+"</span>",{bottom:true,duration:5000})}else{alert(bG)}}function aJ(bG,bH){var bF="";if(bG){bF+='<span style="font-family: monospace">'+bG+"</span>"}bF+='<input type="text"/> <span style="color: #888">';if(bH){bF+='<span style="color: #888">';bF+=bH;bF+="</span>"}return bF}var P="(Javascript regexp)";function a4(bG,bH){var bI=(bH.prefix||"")+" "+(bH.desc||"");var bF=aJ(bH.prefix,bH.desc);ac(bG,bF,bI,bH.onClose,bH)}function Y(bG,bF){if(bG instanceof RegExp&&bF instanceof RegExp){var bI=["global","multiline","ignoreCase","source"];for(var bH=0;bH<bI.length;bH++){var bJ=bI[bH];if(bG[bJ]!==bF[bJ]){return false}}return true}return false}function bB(bF,bK,bG,bH){if(!bK){return}var bJ=aK(bF);var bI=aC(bK,!!bG,!!bH);if(!bI){return}aM(bF,bI);if(Y(bI,bJ.getQuery())){return bI}bJ.setQuery(bI);return bI}function aP(bG){if(bG.source.charAt(0)=="^"){var bF=true}return{token:function(bI){if(bF&&!bI.sol()){bI.skipToEnd();return}var bH=bI.match(bG,false);if(bH){if(bH[0].length==0){bI.next();return"searching"}if(!bI.sol()){bI.backUp(1);if(!bG.exec(bI.next()+bH[0])){bI.next();return null}}bI.match(bG);return"searching"}while(!bI.eol()){bI.next();if(bI.match(bG,false)){break}}},query:bG}}function aM(bF,bI){var bH=aK(bF);var bG=bH.getOverlay();if(!bG||bI!=bG.query){if(bG){bF.removeOverlay(bG)}bG=aP(bI);bF.addOverlay(bG);if(bF.showMatchesOnScrollbar){if(bH.getScrollbarAnnotate()){bH.getScrollbarAnnotate().clear()}bH.setScrollbarAnnotate(bF.showMatchesOnScrollbar(bI))}bH.setOverlay(bG)}}function bD(bF,bG,bI,bH){if(bH===undefined){bH=1}return bF.operation(function(){var bM=bF.getCursor();var bL=bF.getSearchCursor(bI,bM);for(var bJ=0;bJ<bH;bJ++){var bK=bL.find(bG);if(bJ==0&&bK&&bC(bL.from(),bM)){bK=bL.find(bG)}if(!bK){bL=bF.getSearchCursor(bI,(bG)?c(bF.lastLine()):c(bF.firstLine(),0));if(!bL.find(bG)){return}}}return bL.from()})}function aO(bF){var bG=aK(bF);bF.removeOverlay(aK(bF).getOverlay());bG.setOverlay(null);if(bG.getScrollbarAnnotate()){bG.getScrollbarAnnotate().clear();bG.setScrollbarAnnotate(null)}}function ag(bH,bG,bF){if(typeof bH!="number"){bH=bH.line}if(bG instanceof Array){return J(bH,bG)}else{if(bF){return(bH>=bG&&bH<=bF)}else{return bH==bG}}}function bg(bF){var bI=bF.getScrollInfo();var bH=6;var bL=10;var bK=bF.coordsChar({left:0,top:bH+bI.top},"local");var bG=bI.clientHeight-bL+bI.top;var bJ=bF.coordsChar({left:0,top:bG},"local");return{top:bK.line,bottom:bJ.line}}var Z=function(){this.buildCommandMap_()};Z.prototype={processCommand:function(bF,bG,bI){var bH=this;bF.operation(function(){bF.curOp.isVimOp=true;bH._processCommand(bF,bG,bI)})},_processCommand:function(bQ,bP,bG){var bK=bQ.state.vim;var bH=r.registerController.getRegister(":");var bN=bH.toString();if(bK.visualMode){aV(bQ)}var bF=new b.StringStream(bP);bH.setText(bP);var bJ=bG||{};bJ.input=bP;try{this.parseInput_(bQ,bF,bJ)}catch(bO){bq(bQ,bO);throw bO}var bI;var bM;if(!bJ.commandName){if(bJ.line!==undefined){bM="move"}}else{bI=this.matchCommand_(bJ.commandName);if(bI){bM=bI.name;if(bI.excludeFromCommandHistory){bH.setText(bN)}this.parseCommandArgs_(bF,bJ,bI);if(bI.type=="exToKey"){for(var bL=0;bL<bI.toKeys.length;bL++){b.Vim.handleKey(bQ,bI.toKeys[bL],"mapping")}return}else{if(bI.type=="exToEx"){this.processCommand(bQ,bI.toInput);return}}}}if(!bM){bq(bQ,'Not an editor command ":'+bP+'"');return}try{a8[bM](bQ,bJ);if((!bI||!bI.possiblyAsync)&&bJ.callback){bJ.callback()}}catch(bO){bq(bQ,bO);throw bO}},parseInput_:function(bG,bH,bF){bH.eatWhile(":");if(bH.eat("%")){bF.line=bG.firstLine();bF.lineEnd=bG.lastLine()}else{bF.line=this.parseLineSpec_(bG,bH);if(bF.line!==undefined&&bH.eat(",")){bF.lineEnd=this.parseLineSpec_(bG,bH)}}var bI=bH.match(/^(\w+)/);if(bI){bF.commandName=bI[1]}else{bF.commandName=bH.match(/.*/)[0]}return bF},parseLineSpec_:function(bF,bG){var bH=bG.match(/^(\d+)/);if(bH){return parseInt(bH[1],10)-1}switch(bG.next()){case".":return bF.getCursor().line;case"$":return bF.lastLine();case"'":var bI=bF.state.vim.marks[bG.next()];if(bI&&bI.find()){return bI.find().line}throw new Error("Mark not set");default:bG.backUp(1);return undefined}},parseCommandArgs_:function(bG,bJ,bI){if(bG.eol()){return}bJ.argString=bG.match(/.*/)[0];var bH=bI.argDelimiter||/\s+/;var bF=bc(bJ.argString).split(bH);if(bF.length&&bF[0]){bJ.args=bF}},matchCommand_:function(bG){for(var bF=bG.length;bF>0;bF--){var bH=bG.substring(0,bF);if(this.commandMap_[bH]){var bI=this.commandMap_[bH];if(bI.name.indexOf(bG)===0){return bI}}}return null},buildCommandMap_:function(){this.commandMap_={};for(var bG=0;bG<d.length;bG++){var bH=d[bG];var bF=bH.shortName||bH.name;this.commandMap_[bF]=bH}},map:function(bG,bJ,bF){if(bG!=":"&&bG.charAt(0)==":"){if(bF){throw Error("Mode not supported for ex mappings")}var bI=bG.substring(1);if(bJ!=":"&&bJ.charAt(0)==":"){this.commandMap_[bI]={name:bI,type:"exToEx",toInput:bJ.substring(1),user:true}}else{this.commandMap_[bI]={name:bI,type:"exToKey",toKeys:bJ,user:true}}}else{if(bJ!=":"&&bJ.charAt(0)==":"){var bH={keys:bG,type:"keyToEx",exArgs:{input:bJ.substring(1)},user:true};if(bF){bH.context=bF}a.unshift(bH)}else{var bH={keys:bG,type:"keyToKey",toKeys:bJ,user:true};if(bF){bH.context=bF}a.unshift(bH)}}},unmap:function(bG,bF){if(bG!=":"&&bG.charAt(0)==":"){if(bF){throw Error("Mode not supported for ex mappings")}var bI=bG.substring(1);if(this.commandMap_[bI]&&this.commandMap_[bI].user){delete this.commandMap_[bI];return}}else{var bJ=bG;for(var bH=0;bH<a.length;bH++){if(bJ==a[bH].keys&&a[bH].context===bF&&a[bH].user){a.splice(bH,1);return}}}throw Error("No such mapping.")}};var a8={colorscheme:function(bF,bG){if(!bG.args||bG.args.length<1){bq(bF,bF.getOption("theme"));return}bF.setOption("theme",bG.args[0])},map:function(bF,bI,bG){var bH=bI.args;if(!bH||bH.length<2){if(bF){bq(bF,"Invalid mapping: "+bI.input)}return}m.map(bH[0],bH[1],bG)},imap:function(bF,bG){this.map(bF,bG,"insert")},nmap:function(bF,bG){this.map(bF,bG,"normal")},vmap:function(bF,bG){this.map(bF,bG,"visual")},unmap:function(bF,bI,bG){var bH=bI.args;if(!bH||bH.length<1){if(bF){bq(bF,"No such mapping: "+bI.input)}return}m.unmap(bH[0],bG)},move:function(bF,bG){bf.processCommand(bF,bF.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true},repeatOverride:bG.line+1})},set:function(bO,bK){var bI=bK.args;var bL=bK.setCfg||{};if(!bI||bI.length<1){if(bO){bq(bO,"Invalid mapping: "+bK.input)}return}var bM=bI[0].split("=");var bG=bM[0];var bN=bM[1];var bJ=false;if(bG.charAt(bG.length-1)=="?"){if(bN){throw Error("Trailing characters: "+bK.argString)}bG=bG.substring(0,bG.length-1);bJ=true}if(bN===undefined&&bG.substring(0,2)=="no"){bG=bG.substring(2);bN=false}var bH=aw[bG]&&aw[bG].type=="boolean";if(bH&&bN==undefined){bN=true}if(!bH&&bN===undefined||bJ){var bF=o(bG,bO,bL);if(bF===true||bF===false){bq(bO," "+(bF?"":"no")+bG)}else{bq(bO,"  "+bG+"="+bF)}}else{aL(bG,bN,bO,bL)}},setlocal:function(bF,bG){bG.setCfg={scope:"local"};this.set(bF,bG)},setglobal:function(bF,bG){bG.setCfg={scope:"global"};this.set(bF,bG)},registers:function(bK,bG){var bM=bG.args;var bJ=r.registerController.registers;var bH="----------Registers----------<br><br>";if(!bM){for(var bF in bJ){var bN=bJ[bF].toString();if(bN.length){bH+='"'+bF+"    "+bN+"<br>"}}}else{var bF;bM=bM.join("");for(var bI=0;bI<bM.length;bI++){bF=bM.charAt(bI);if(!r.registerController.isValidRegister(bF)){continue}var bL=bJ[bF]||new bs();bH+='"'+bF+"    "+bL.toString()+"<br>"}}bq(bK,bH)},sort:function(bO,bY){var bP,bI,bG,bH;function bJ(){if(bY.argString){var b2=new b.StringStream(bY.argString);if(b2.eat("!")){bP=true}if(b2.eol()){return}if(!b2.eatSpace()){return"Invalid arguments"}var b4=b2.match(/[a-z]+/);if(b4){b4=b4[0];bI=b4.indexOf("i")!=-1;bG=b4.indexOf("u")!=-1;var b1=b4.indexOf("d")!=-1&&1;var b3=b4.indexOf("x")!=-1&&1;var b0=b4.indexOf("o")!=-1&&1;if(b1+b3+b0>1){return"Invalid arguments"}bH=b1&&"decimal"||b3&&"hex"||b0&&"octal"}if(b2.eatSpace()&&b2.match(/\/.*\//)){"patterns not supported"}}}var bK=bJ();if(bK){bq(bO,bK+": "+bY.argString);return}var bT=bY.line||bO.firstLine();var bX=bY.lineEnd||bY.line||bO.lastLine();if(bT==bX){return}var bN=c(bT,0);var bV=c(bX,aZ(bO,bX));var bS=bO.getRange(bN,bV).split("\n");var bL=(bH=="decimal")?/(-?)([\d]+)/:(bH=="hex")?/(-?)(?:0x)?([0-9a-f]+)/i:(bH=="octal")?/([0-7]+)/:null;var bM=(bH=="decimal")?10:(bH=="hex")?16:(bH=="octal")?8:null;var bQ=[],bU=[];if(bH){for(var bW=0;bW<bS.length;bW++){if(bL.exec(bS[bW])){bQ.push(bS[bW])}else{bU.push(bS[bW])}}}else{bU=bS}function bZ(b1,b0){if(bP){var b2;b2=b1;b1=b0;b0=b2}if(bI){b1=b1.toLowerCase();b0=b0.toLowerCase()}var b4=bH&&bL.exec(b1);var b3=bH&&bL.exec(b0);if(!b4){return b1<b0?-1:1}b4=parseInt((b4[1]+b4[2]).toLowerCase(),bM);b3=parseInt((b3[1]+b3[2]).toLowerCase(),bM);return b4-b3}bQ.sort(bZ);bU.sort(bZ);bS=(!bP)?bU.concat(bQ):bQ.concat(bU);if(bG){var bR=bS;var bF;bS=[];for(var bW=0;bW<bR.length;bW++){if(bR[bW]!=bF){bS.push(bR[bW])}bF=bR[bW]}}bO.replaceRange(bS.join("\n"),bN,bV)},global:function(bS,bJ){var bG=bJ.argString;if(!bG){bq(bS,"Regular Expression missing from global");return}var bM=(bJ.line!==undefined)?bJ.line:bS.firstLine();var bK=bJ.lineEnd||bJ.line||bS.lastLine();var bR=x(bG);var bU=bG,bI;if(bR.length){bU=bR[0];bI=bR.slice(1,bR.length).join("/")}if(bU){try{bB(bS,bU,true,true)}catch(bP){bq(bS,"Invalid regex: "+bU);return}}var bQ=aK(bS).getQuery();var bF=[],bO="";for(var bL=bM;bL<=bK;bL++){var bH=bQ.test(bS.getLine(bL));if(bH){bF.push(bL+1);bO+=bS.getLine(bL)+"<br>"}}if(!bI){bq(bS,bO);return}var bN=0;var bT=function(){if(bN<bF.length){var bV=bF[bN]+bI;m.processCommand(bS,bV,{callback:bT})}bN++};bT()},substitute:function(bM,bU){if(!bM.getSearchCursor){throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.")}var bV=bU.argString;var bP=bV?x(bV):[];var bN,bO="",bF,bG,bK;var bL=false;var bR=false;if(bP.length){bN=bP[0];bO=bP[1];if(bO!==undefined){if(o("pcre")){bO=ah(bO)}else{bO=bx(bO)}r.lastSubstituteReplacePart=bO}bF=bP[2]?bP[2].split(" "):[]}else{if(bV&&bV.length){bq(bM,"Substitutions should be of the form :s/pattern/replace/");return}}if(bF){bG=bF[0];bK=parseInt(bF[1]);if(bG){if(bG.indexOf("c")!=-1){bL=true;bG.replace("c","")}if(bG.indexOf("g")!=-1){bR=true;bG.replace("g","")}bN=bN+"/"+bG}}if(bN){try{bB(bM,bN,true,true)}catch(bT){bq(bM,"Invalid regex: "+bN);return}}bO=bO||r.lastSubstituteReplacePart;if(bO===undefined){bq(bM,"No previous substitute regular expression");return}var bI=aK(bM);var bJ=bI.getQuery();var bQ=(bU.line!==undefined)?bU.line:bM.getCursor().line;var bS=bU.lineEnd||bQ;if(bQ==bM.firstLine()&&bS==bM.lastLine()){bS=Infinity}if(bK){bQ=bS;bS=bQ+bK-1}var bW=aa(bM,c(bQ,0));var bH=bM.getSearchCursor(bJ,bW);bb(bM,bL,bR,bQ,bS,bH,bJ,bO,bU.callback)},redo:b.commands.redo,undo:b.commands.undo,write:function(bF){if(b.commands.save){b.commands.save(bF)}else{bF.save()}},nohlsearch:function(bF){aO(bF)},delmarks:function(bP,bK){if(!bK.argString||!bc(bK.argString)){bq(bP,"Argument required");return}var bF=bP.state.vim;var bQ=new b.StringStream(bc(bK.argString));while(!bQ.eol()){bQ.eatSpace();var bN=bQ.pos;if(!bQ.match(/[a-zA-Z]/,false)){bq(bP,"Invalid argument: "+bK.argString.substring(bN));return}var bH=bQ.next();if(bQ.match("-",true)){if(!bQ.match(/[a-zA-Z]/,false)){bq(bP,"Invalid argument: "+bK.argString.substring(bN));return}var bI=bH;var bM=bQ.next();if(E(bI)&&E(bM)||B(bI)&&B(bM)){var bG=bI.charCodeAt(0);var bO=bM.charCodeAt(0);if(bG>=bO){bq(bP,"Invalid argument: "+bK.argString.substring(bN));return}for(var bL=0;bL<=bO-bG;bL++){var bJ=String.fromCharCode(bG+bL);delete bF.marks[bJ]}}else{bq(bP,"Invalid argument: "+bI+"-");return}}else{delete bF.marks[bH]}}}};var m=new Z();function bb(bT,bG,bI,bO,bM,bH,bQ,bK,bU){bT.state.vim.exMode=true;var bL=false;var bS=bH.from();function bP(){bT.operation(function(){while(!bL){bJ();bN()}bR()})}function bJ(){var bW=bT.getRange(bH.from(),bH.to());var bV=bW.replace(bQ,bK);bH.replace(bV)}function bN(){while(bH.findNext()&&ag(bH.from(),bO,bM)){if(!bI&&bS&&bH.from().line==bS.line){continue}bT.scrollIntoView(bH.from(),30);bT.setSelection(bH.from(),bH.to());bS=bH.from();bL=false;return}bL=true}function bR(bW){if(bW){bW()}bT.focus();if(bS){bT.setCursor(bS);var bV=bT.state.vim;bV.exMode=false;bV.lastHPos=bV.lastHSPos=bS.ch}if(bU){bU()}}function bF(bY,bV,bZ){b.e_stop(bY);var bW=b.keyName(bY);switch(bW){case"Y":bJ();bN();break;case"N":bN();break;case"A":var bX=bU;bU=undefined;bT.operation(bP);bU=bX;break;case"L":bJ();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":bR(bZ);break}if(bL){bR(bZ)}return true}bN();if(bL){bq(bT,"No matches for "+bQ.source);return}if(!bG){bP();if(bU){bU()}return}a4(bT,{prefix:"replace with <strong>"+bK+"</strong> (y/n/a/q/l)",onKeyDown:bF})}b.keyMap.vim={attach:t,detach:i,call:a6};function w(bN){var bG=bN.state.vim;var bI=r.macroModeState;var bL=r.registerController.getRegister(".");var bF=bI.isPlaying;var bJ=bI.lastInsertModeChanges;var bO=[];if(!bF){var bK=bJ.inVisualBlock?bG.lastSelection.visualBlock.height:1;var bM=bJ.changes;var bO=[];var bH=0;while(bH<bM.length){bO.push(bM[bH]);if(bM[bH] instanceof bo){bH++}else{bH+=bK}}bJ.changes=bO;bN.off("change",bl);b.off(bN.getInputField(),"keydown",W)}if(!bF&&bG.insertModeRepeat>1){y(bN,bG,bG.insertModeRepeat-1,true);bG.lastEditInputState.repeatOverride=bG.insertModeRepeat}delete bG.insertModeRepeat;bG.insertMode=false;bN.setCursor(bN.getCursor().line,bN.getCursor().ch-1);bN.setOption("keyMap","vim");bN.setOption("disableInput",true);bN.toggleOverwrite(false);bL.setText(bJ.changes.join(""));b.signal(bN,"vim-mode-change",{mode:"normal"});if(bI.isRecording){ap(bI)}}function p(bF){a.unshift(bF)}function aB(bK,bJ,bH,bG,bF){var bL={keys:bK,type:bJ};bL[bJ]=bH;bL[bJ+"Args"]=bG;for(var bI in bF){bL[bI]=bF[bI]}p(bL)}aN("insertModeEscKeysTimeout",200,"number");b.keyMap["vim-insert"]={"Ctrl-N":"autocomplete","Ctrl-P":"autocomplete",Enter:function(bF){var bG=b.commands.newlineAndIndentContinueComment||b.commands.newlineAndIndent;bG(bF)},fallthrough:["default"],attach:t,detach:i,call:a6};b.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:t,detach:i,call:a6};function H(bN,bH,bI,bF){var bP=r.registerController.getRegister(bF);if(bF==":"){if(bP.keyBuffer[0]){m.processCommand(bN,bP.keyBuffer[0])}bI.isPlaying=false;return}var bG=bP.keyBuffer;var bL=0;bI.isPlaying=true;bI.replaySearchQueries=bP.searchQueries.slice(0);for(var bJ=0;bJ<bG.length;bJ++){var bQ=bG[bJ];var bK,bO;while(bQ){bK=(/<\w+-.+?>|<\w+>|./).exec(bQ);bO=bK[0];bQ=bQ.substring(bK.index+bO.length);b.Vim.handleKey(bN,bO,"macro");if(bH.insertMode){var bM=bP.insertModeChanges[bL++].changes;r.macroModeState.lastInsertModeChanges.changes=bM;av(bN,bM,1);w(bN)}}}bI.isPlaying=false}function I(bI,bF){if(bI.isPlaying){return}var bH=bI.latestRegister;var bG=r.registerController.getRegister(bH);if(bG){bG.pushText(bF)}}function ap(bH){if(bH.isPlaying){return}var bG=bH.latestRegister;var bF=r.registerController.getRegister(bG);if(bF&&bF.pushInsertModeChanges){bF.pushInsertModeChanges(bH.lastInsertModeChanges)}}function O(bI,bH){if(bI.isPlaying){return}var bG=bI.latestRegister;var bF=r.registerController.getRegister(bG);if(bF&&bF.pushSearchQuery){bF.pushSearchQuery(bH)}}function bl(bG,bF){var bI=r.macroModeState;var bH=bI.lastInsertModeChanges;if(!bI.isPlaying){while(bF){bH.expectCursorActivityForChange=true;if(bF.origin=="+input"||bF.origin=="paste"||bF.origin===undefined){var bJ=bF.text.join("\n");bH.changes.push(bJ)}bF=bF.next}}}function ab(bF){var bG=bF.state.vim;if(bG.insertMode){var bI=r.macroModeState;if(bI.isPlaying){return}var bH=bI.lastInsertModeChanges;if(bH.expectCursorActivityForChange){bH.expectCursorActivityForChange=false}else{bH.changes=[]}}else{if(!bF.curOp.isVimOp){s(bF,bG)}}if(bG.visualMode){ad(bF)}}function ad(bF){var bG=bF.state.vim;var bI=aa(bF,C(bG.sel.head));var bH=D(bI,0,1);if(bG.fakeCursor){bG.fakeCursor.clear()}bG.fakeCursor=bF.markText(bI,bH,{className:"cm-animate-fat-cursor"})}function s(bF,bG){var bH=bF.getCursor("anchor");var bI=bF.getCursor("head");if(bG.visualMode&&!bF.somethingSelected()){aV(bF,false)}else{if(!bG.visualMode&&!bG.insertMode&&bF.somethingSelected()){bG.visualMode=true;bG.visualLine=false;b.signal(bF,"vim-mode-change",{mode:"visual"})}}if(bG.visualMode){var bJ=!aQ(bI,bH)?-1:0;var bK=aQ(bI,bH)?-1:0;bI=D(bI,0,bJ);bH=D(bH,0,bK);bG.sel={anchor:bH,head:bI};aT(bF,bG,"<",ay(bI,bH));aT(bF,bG,">",bd(bI,bH))}else{if(!bG.insertMode){bG.lastHPos=bF.getCursor().ch}}}function bo(bF){this.keyName=bF}function W(bJ){var bI=r.macroModeState;var bH=bI.lastInsertModeChanges;var bG=b.keyName(bJ);if(!bG){return}function bF(){bH.changes.push(new bo(bG));return true}if(bG.indexOf("Delete")!=-1||bG.indexOf("Backspace")!=-1){b.lookupKey(bG,"vim-insert",bF)}}function y(bN,bI,bG,bF){var bK=r.macroModeState;bK.isPlaying=true;var bO=!!bI.lastEditActionCommand;var bL=bI.inputState;function bH(){if(bO){bf.processAction(bN,bI,bI.lastEditActionCommand)}else{bf.evalInput(bN,bI)}}function bM(bQ){if(bK.lastInsertModeChanges.changes.length>0){bQ=!bI.lastEditActionCommand?1:bQ;var bP=bK.lastInsertModeChanges;av(bN,bP.changes,bQ)}}bI.inputState=bI.lastEditInputState;if(bO&&bI.lastEditActionCommand.interlaceInsertRepeat){for(var bJ=0;bJ<bG;bJ++){bH();bM(1)}}else{if(!bF){bH()}bM(bG)}bI.inputState=bL;if(bI.insertMode&&!bF){w(bN)}bK.isPlaying=false}function av(bQ,bP,bG){function bM(bS){if(typeof bS=="string"){b.commands[bS](bQ)}else{bS(bQ)}return true}var bO=bQ.getCursor("head");var bF=r.macroModeState.lastInsertModeChanges.inVisualBlock;if(bF){var bK=bQ.state.vim;var bH=bK.lastSelection;var bJ=bi(bH.anchor,bH.head);aW(bQ,bO,bJ.line+1);bG=bQ.listSelections().length;bQ.setCursor(bO)}for(var bL=0;bL<bG;bL++){if(bF){bQ.setCursor(D(bO,bL,0))}for(var bI=0;bI<bP.length;bI++){var bN=bP[bI];if(bN instanceof bo){b.lookupKey(bN.keyName,"vim-insert",bM)}else{var bR=bQ.getCursor();bQ.replaceRange(bN,bR,bR)}}}if(bF){bQ.setCursor(D(bO,0,1))}}A();return aR};b.Vim=e()});