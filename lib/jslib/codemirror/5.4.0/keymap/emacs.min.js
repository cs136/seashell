(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(w){var l=w.Pos;function L(P,i){return P.line==i.line&&P.ch==i.ch}var o=[];function M(i){o.push(i);if(o.length>50){o.shift()}}function D(i){if(!o.length){return M(i)}o[o.length-1]+=i}function f(i){return o[o.length-(i?Math.min(i,1):1)]||""}function u(){if(o.length>1){o.pop()}return f()}var z=null;function s(i,S,R,Q,P){if(P==null){P=i.getRange(S,R)}if(Q&&z&&z.cm==i&&L(S,z.pos)&&i.isClean(z.gen)){D(P)}else{M(P)}i.replaceRange("",S,R,"+delete");if(Q){z={cm:i,pos:S,gen:i.changeGeneration()}}else{z=null}}function c(i,Q,P){return i.findPosH(Q,P,"char",true)}function d(i,Q,P){return i.findPosH(Q,P,"word",true)}function y(i,Q,P){return i.findPosV(Q,P,"line",i.doc.sel.goalColumn)}function t(i,Q,P){return i.findPosV(Q,P,"page",i.doc.sel.goalColumn)}function C(T,S,P){var U=S.line,W=T.getLine(U);var V=/\S/.test(P<0?W.slice(0,S.ch):W.slice(S.ch));var i=T.firstLine(),Q=T.lastLine();for(;;){U+=P;if(U<i||U>Q){return T.clipPos(l(U-P,P<0?0:null))}W=T.getLine(U);var R=/\S/.test(W);if(R){V=true}else{if(V){return l(U,0)}}}}function b(i,V,R){var P=V.line,T=V.ch;var U=i.getLine(V.line),Q=false;for(;;){var S=U.charAt(T+(R<0?-1:0));if(!S){if(P==(R<0?i.firstLine():i.lastLine())){return l(P,T)}U=i.getLine(P+R);if(!/\S/.test(U)){return l(P,T)}P+=R;T=R<0?U.length:0;continue}if(Q&&/[!?.]/.test(S)){return l(P,T+(R>0?1:0))}if(!Q){Q=/\w/.test(S)}T+=R}}function g(i,V,P){var S;if(i.findMatchingBracket&&(S=i.findMatchingBracket(V,true))&&S.match&&(S.forward?1:-1)==P){return P>0?l(S.to.line,S.to.ch+1):S.to}for(var U=true;;U=false){var R=i.getTokenAt(V);var T=l(V.line,P<0?R.start:R.end);if(U&&P>0&&R.end==V.ch||!/\w/.test(R.string)){var Q=i.findPosH(T,P,"char");if(L(T,Q)){return V}else{V=Q}}else{return T}}}function k(i,P){var Q=i.state.emacsPrefix;if(!Q){return P?null:1}H(i);return Q=="-"?-1:Number(Q)}function F(P){var i=typeof P=="string"?function(Q){Q.execCommand(P)}:P;return function(Q){var S=k(Q);i(Q);for(var R=1;R<S;++R){i(Q)}}}function v(P,V,U,Q){var T=k(P);if(T<0){Q=-Q;T=-T}for(var S=0;S<T;++S){var R=U(P,V,Q);if(L(R,V)){break}V=R}return V}function n(Q,i){var P=function(R){R.extendSelection(v(R,R.getCursor(),Q,i))};P.motion=true;return P}function G(P,T,Q){var S=P.listSelections(),U;var R=S.length;while(R--){U=S[R].head;s(P,U,v(P,U,T,Q),true)}}function e(P){if(P.somethingSelected()){var S=P.listSelections(),R;var Q=S.length;while(Q--){R=S[Q];s(P,R.anchor,R.head)}return true}}function A(i,P){if(i.state.emacsPrefix){if(P!="-"){i.state.emacsPrefix+=P}return}i.state.emacsPrefix=P;i.on("keyHandled",j);i.on("inputRead",B)}var h={"Alt-G":true,"Ctrl-X":true,"Ctrl-Q":true,"Ctrl-U":true};function j(P,i){if(!P.state.emacsPrefixMap&&!h.hasOwnProperty(i)){H(P)}}function H(i){i.state.emacsPrefix=null;i.off("keyHandled",j);i.off("inputRead",B)}function B(Q,T){var U=k(Q);if(U>1&&T.origin=="+input"){var S=T.text.join("\n"),P="";for(var R=1;R<U;++R){P+=S}Q.replaceSelection(P)}}function r(i){i.state.emacsPrefixMap=true;i.addKeyMap(m);i.on("keyHandled",q);i.on("inputRead",q)}function q(P,i){if(typeof i=="string"&&(/^\d$/.test(i)||i=="Ctrl-U")){return}P.removeKeyMap(m);P.state.emacsPrefixMap=false;P.off("keyHandled",q);P.off("inputRead",q)}function E(i){i.setCursor(i.getCursor());i.setExtending(!i.getExtending());i.on("change",function(){i.setExtending(false)})}function I(i){i.setExtending(false);i.setCursor(i.getCursor())}function O(i,Q,P){if(i.openDialog){i.openDialog(Q+': <input type="text" style="width: 10em"/>',P,{bottom:true})}else{P(prompt(Q,""))}}function J(i,R){var Q=i.getCursor(),P=i.findPosH(Q,1,"word");i.replaceRange(R(i.getRange(Q,P)),Q,P);i.setCursor(P)}function a(Q){var V=Q.getCursor(),R=V.line,T=V.ch;var P=[];while(R>=Q.firstLine()){var U=Q.getLine(R);for(var S=T==null?U.length:T;S>0;){var T=U.charAt(--S);if(T==")"){P.push("(")}else{if(T=="]"){P.push("[")}else{if(T=="}"){P.push("{")}else{if(/[\(\{\[]/.test(T)&&(!P.length||P.pop()!=T)){return Q.extendSelection(l(R,S))}}}}}--R;T=null}}function p(i){i.execCommand("clearSearch");I(i)}var x=w.keyMap.emacs=w.normalizeKeyMap({"Ctrl-W":function(i){s(i,i.getCursor("start"),i.getCursor("end"))},"Ctrl-K":F(function(i){var R=i.getCursor(),P=i.clipPos(l(R.line));var Q=i.getRange(R,P);if(!/\S/.test(Q)){Q+="\n";P=l(R.line+1,0)}s(i,R,P,true,Q)}),"Alt-W":function(i){M(i.getSelection());I(i)},"Ctrl-Y":function(i){var P=i.getCursor();i.replaceRange(f(k(i)),P,P,"paste");i.setSelection(P,i.getCursor())},"Alt-Y":function(i){i.replaceSelection(u(),"around","paste")},"Ctrl-Space":E,"Ctrl-Shift-2":E,"Ctrl-F":n(c,1),"Ctrl-B":n(c,-1),Right:n(c,1),Left:n(c,-1),"Ctrl-D":function(i){G(i,c,1)},Delete:function(i){e(i)||G(i,c,1)},"Ctrl-H":function(i){G(i,c,-1)},Backspace:function(i){e(i)||G(i,c,-1)},"Alt-F":n(d,1),"Alt-B":n(d,-1),"Alt-D":function(i){G(i,d,1)},"Alt-Backspace":function(i){G(i,d,-1)},"Ctrl-N":n(y,1),"Ctrl-P":n(y,-1),Down:n(y,1),Up:n(y,-1),"Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":n(t,-1),"Ctrl-V":n(t,1),PageUp:n(t,-1),PageDown:n(t,1),"Ctrl-Up":n(C,-1),"Ctrl-Down":n(C,1),"Alt-A":n(b,-1),"Alt-E":n(b,1),"Alt-K":function(i){G(i,b,1)},"Ctrl-Alt-K":function(i){G(i,g,1)},"Ctrl-Alt-Backspace":function(i){G(i,g,-1)},"Ctrl-Alt-F":n(g,1),"Ctrl-Alt-B":n(g,-1),"Shift-Ctrl-Alt-2":function(i){var P=i.getCursor();i.setSelection(v(i,P,g,1),P)},"Ctrl-Alt-T":function(i){var P=g(i,i.getCursor(),-1),R=g(i,P,1);var S=g(i,R,1),Q=g(i,S,-1);i.replaceRange(i.getRange(Q,S)+i.getRange(R,Q)+i.getRange(P,R),P,S)},"Ctrl-Alt-U":F(a),"Alt-Space":function(i){var S=i.getCursor(),R=S.ch,Q=S.ch,P=i.getLine(S.line);while(R&&/\s/.test(P.charAt(R-1))){--R}while(Q<P.length&&/\s/.test(P.charAt(Q))){++Q}i.replaceRange(" ",l(S.line,R),l(S.line,Q))},"Ctrl-O":F(function(i){i.replaceSelection("\n","start")}),"Ctrl-T":F(function(i){i.execCommand("transposeChars")}),"Alt-C":F(function(i){J(i,function(P){var Q=P.search(/\w/);if(Q==-1){return P}return P.slice(0,Q)+P.charAt(Q).toUpperCase()+P.slice(Q+1).toLowerCase()})}),"Alt-U":F(function(i){J(i,function(P){return P.toUpperCase()})}),"Alt-L":F(function(i){J(i,function(P){return P.toLowerCase()})}),"Alt-;":"toggleComment","Ctrl-/":F("undo"),"Shift-Ctrl--":F("undo"),"Ctrl-Z":F("undo"),"Cmd-Z":F("undo"),"Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findNext","Ctrl-R":"findPrev","Ctrl-G":p,"Shift-Alt-5":"replace","Alt-/":"autocomplete","Ctrl-J":"newlineAndIndent",Enter:false,Tab:"indentAuto","Alt-G G":function(i){var P=k(i,true);if(P!=null&&P>0){return i.setCursor(P-1)}O(i,"Goto line",function(R){var Q;if(R&&!isNaN(Q=Number(R))&&Q==Q|0&&Q>0){i.setCursor(Q-1)}})},"Ctrl-X Tab":function(i){i.indentSelection(k(i,true)||i.getOption("indentUnit"))},"Ctrl-X Ctrl-X":function(i){i.setSelection(i.getCursor("head"),i.getCursor("anchor"))},"Ctrl-X Ctrl-S":"save","Ctrl-X Ctrl-W":"save","Ctrl-X S":"saveAll","Ctrl-X F":"open","Ctrl-X U":F("undo"),"Ctrl-X K":"close","Ctrl-X Delete":function(i){s(i,i.getCursor(),b(i,i.getCursor(),1),true)},"Ctrl-X H":"selectAll","Ctrl-Q Tab":F("insertTab"),"Ctrl-U":r});var m={"Ctrl-G":H};function N(i){m[i]=function(P){A(P,i)};x["Ctrl-"+i]=function(P){A(P,i)};h["Ctrl-"+i]=true}for(var K=0;K<10;++K){N(String(K))}N("-")});