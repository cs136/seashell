language: c++
compiler: clang
sudo: required
dist: trusty
cache: ccache
env:
  - RACKET_DIR=$HOME/racket RACKET_VERSION=6.4 NODE_PATH=/usr/local/lib/node_modules
before_install:
  # Get Racket
  - git clone https://github.com/greghendershott/travis-racket.git >/dev/null
  - cat travis-racket/install-racket.sh | bash >/dev/null
  # Install latest node (ES6)
  - nvm install node
  - nvm use node
  # JavaScript linter
  - npm install -g jshint >/dev/null
  - cd src/tests/frontend-tests
  - npm install karma --save-dev >/dev/null
  - npm install karma-jasmine --save-dev >/dev/null
  - npm install karma-phantomjs-launcher --save-dev >/dev/null
  - npm install jasmine-core --save-dev >/dev/null
  - cd ../../..
  # Install clang ccache
  - sudo ln -s `which ccache` /usr/lib/ccache/clang
  - sudo ln -s `which ccache` /usr/lib/ccache/clang++
script:
  - mkdir build >/dev/null
  - cd build >/dev/null
  - cmake -Wno-dev -DCMAKE_C_FLAGS="-Qunused-arguments -fcolor-diagnostics" -DCMAKE_CXX_FLAGS="-Qunused-arguments -fcolor-diagnostics" -DSEASHELL_MZTEXT=$HOME/racket/bin/mztext -DSCRIBBLE=$HOME/racket/bin/scribble -DSEASHELL_RACKET=$HOME/racket/bin/racket -DCMAKE_INSTALL_PREFIX=$HOME/install -DPROCESSOR_COUNT=1 -DLLVM_TARGETS_TO_BUILD=X86 ..
  - make -j2
  - CTEST_OUTPUT_ON_FAILURE=true make test
  - ../src/tests/frontend-tests/node_modules/karma/bin/karma start ../src/tests/frontend-tests/seashell.conf.js
  - make install >/dev/null
